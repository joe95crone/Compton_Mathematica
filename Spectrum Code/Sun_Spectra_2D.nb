(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     80294,       2016]
NotebookOptionsPosition[     73250,       1898]
NotebookOutlinePosition[     73598,       1913]
CellTagsIndexPosition[     73555,       1910]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Sun 2D Spectrum Calculation", "Title",
 CellChangeTimes->{{3.8105291466884193`*^9, 
  3.8105291543832254`*^9}},ExpressionUUID->"140bdbae-bad8-4718-a1da-\
eb929332eda8"],

Cell[TextData[{
 "An extension of the 1D Sun Spectrum (E\[Gamma] vs ",
 Cell[BoxData[
  FormBox[
   FractionBox["dN\[Gamma]", "dE\[Gamma]"], TraditionalForm]],ExpressionUUID->
  "071c3fbe-02c0-42eb-b91a-1ce222df9862"],
 " ) to 2D. Previously in SUN1D (16) PRSTAB 12, 062801 (2009) the vertical \
emittance effect is neglected, as storage ring beams are used. ERL\
\[CloseCurlyQuote]s use circular beams so a 2D calculation is required, this \
is also needed to benchmark an improvement (relating to when source size and \
collimator size are similar) to ICCS3D by Balsa Terzic. The 2D model uses \
(3.18) of C. Sun\[CloseCurlyQuote]s thesis (also found in (A8) PRSTAB 14, \
044701 (2011)). The polarisation term is negligible for the case where the \
polarisation is in the x-axis of the scattering plane (my answer) or we can \
notice the term vanishes as ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["\[Theta]", "f"], TraditionalForm]],ExpressionUUID->
  "517022c0-3d5c-4196-9336-b71898eea15d"],
 " goes to zero, i.e. in the forward direction. This means you can just drop \
the term entirely and it won\[CloseCurlyQuote]t make much difference in the \
final result (Geoff\[CloseCurlyQuote]s answer)."
}], "Text",
 CellChangeTimes->{{3.8105291778942523`*^9, 3.810529434043118*^9}, {
  3.810529464974168*^9, 3.8105295751864758`*^9}, {3.8105296231426525`*^9, 
  3.810529673014801*^9}, {3.8148585867561026`*^9, 3.814858589294667*^9}, {
  3.8148590595979996`*^9, 
  3.8148590602834587`*^9}},ExpressionUUID->"2b8ba76a-521c-469f-a378-\
d7396e3be18e"],

Cell[TextData[{
 StyleBox["Potential Error Sources",
  FontWeight->"Bold"],
 "\n",
 Cell[BoxData[
  FormBox[
   RowBox[{"\[Bullet]", " ", 
    SubscriptBox["\[Sigma]", "k"]}], TraditionalForm]],ExpressionUUID->
  "862cd4c6-3731-41d9-a66f-5c1429283ab6"],
 " is never defined in Sun\[CloseCurlyQuote]s thesis - the specific form I \
have used here may be wrong. Potentially Check Siegmann Laser book to see \
exact definition. Not used in Siegmann laser book, convinced myself that I am \
using the correct definition though as derived ",
 Cell[BoxData[
  FormBox[
   FractionBox["\[CapitalDelta]k", "k"], TraditionalForm]],ExpressionUUID->
  "4de22a2d-51dc-4104-a960-3ae9b1b3ec41"],
 "and used in form that matches ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["\[Sigma]", 
    SubscriptBox["E", "e"]], TraditionalForm]],ExpressionUUID->
  "006057f7-4c53-4587-8e8c-b195bab19dfb"],
 " usage and both are rms energy spreads.\n\[Bullet] The integral over k goes \
from \[Infinity] to 0 to sum over all modes (confirmed by Geoff) in the laser \
but its impractical. Implemented k \[PlusMinus] 3\[CapitalDelta]k to just go \
for the fundamental harmonic + a bandwidth. Would need convergence testing\n\
\[Bullet] Terms such as ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["N", "laser"], TraditionalForm]],ExpressionUUID->
  "8e4f9262-3ffb-4e4c-b8bf-1be60a99b760"],
 " and ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["z", "R"], TraditionalForm]],ExpressionUUID->
  "d096843d-df6f-4da7-99e7-870379e6cbdd"],
 " which are outside the integration are actually dependent on \[Lambda] and \
therefore k. I can understand ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["N", "Laser"], TraditionalForm]],ExpressionUUID->
  "62ba5941-f926-47ec-811a-1aa25d99512f"],
 " as it is taking the average and it is invariant but ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["z", "R"], TraditionalForm]],ExpressionUUID->
  "1a9c66c4-d7e1-4c14-95de-2fca55318f5d"],
 " seems more spurious. ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["z", "R"], TraditionalForm]],ExpressionUUID->
  "57abc87e-49f8-482b-a7ab-091881b9d6b0"],
 " is held constant throughout currently. (Geoff says taking these as \
constant is the best approximation we can do).\n\[Bullet] Currently the code \
does not take the laser bandwidth variation into account with the cross \
section, whilst this is predicted to be a small effect it is still not a full \
treatment of laser energy spread. In practice this means that EL is kept \
constant during integration. Maybe this full treatment could be added though?"
}], "Text",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQBWIQvaaKXZUl5Y2j6IH9YPpCkIkOiH7996AeiL53YosZ
iA7ozrQA0QqPXD6wAmmHDoWvIDpqlh0DG5Cetc2YC0TLfhJ+oQuk58h5vQfR
E97yfQbR/Cu5v4FokcpJ1/WBdEQF91MQfX7NGi9DIH1KhTkURHs9OZcCovn+
zE4D0TWB6X+NgXTOvSIGEyA9/XjqNRC9I2zFdRCd1feZwTj1jWPTxSIWEL0n
7JRvGJCeyzMtHERbdBXEgOhTu0NjQfQTJTXZy0D6zDVHMD1BZFloUBrQ/NPe
KSB6O9eOfBD9brpXOYh2OLlv35wsoHqn+CMg+tTUypMgOm3BsrMgmuV+OI9L
zhvHbXeXqYBoAJCgoUQ=
  "],ExpressionUUID->"b97ac988-8150-4d2e-9ea9-1c81e9f89e5a"],

Cell[CellGroupData[{

Cell["Units, Constants and Cases", "Section",
 CellChangeTimes->{{3.810529733676788*^9, 3.810529744579461*^9}, {
  3.810529837926977*^9, 
  3.8105298450950384`*^9}},ExpressionUUID->"0c691fe7-f078-4b73-b0b2-\
e8e11224ef50"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "Units", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"MeV", "=", 
     SuperscriptBox["10", "6"]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"keV", "=", 
     SuperscriptBox["10", "3"]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nC", "=", 
     SuperscriptBox["10", 
      RowBox[{"-", "9"}]]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pC", "=", 
     SuperscriptBox["10", 
      RowBox[{"-", "12"}]]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Mu]J", "=", 
     SuperscriptBox["10", 
      RowBox[{"-", "6"}]]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nm", "=", 
     SuperscriptBox["10", 
      RowBox[{"-", "9"}]]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mrad", "=", 
     SuperscriptBox["10", 
      RowBox[{"-", "3"}]]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mm", "=", 
     SuperscriptBox["10", 
      RowBox[{"-", "3"}]]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Mu]m", "=", 
     SuperscriptBox["10", 
      RowBox[{"-", "6"}]]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.810529754020178*^9, 3.810529758798592*^9}, {
  3.810529818755046*^9, 3.810529823467247*^9}, {3.8105298694097576`*^9, 
  3.8105299825196705`*^9}, {3.810617269443308*^9, 3.8106172847507067`*^9}, {
  3.814866703874275*^9, 
  3.8148667151197877`*^9}},ExpressionUUID->"b7330d44-48d7-4587-bf2f-\
669d7a521eec"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "Units", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"phkeVnC", "=", 
    FractionBox[
     RowBox[{"keV", "*", "nC"}], "elecharge"]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.814866675251018*^9, 
  3.814866728509469*^9}},ExpressionUUID->"cc040c97-18d7-4864-a1bf-\
7d6c20093d98"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "Constants", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"re", "=", 
     RowBox[{"2.8179403262", "*", 
      SuperscriptBox["10", 
       RowBox[{"-", "15"}]]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"clight", "=", "299792458"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"hbar", "=", 
     RowBox[{"6.5821", "*", 
      SuperscriptBox["10", 
       RowBox[{"-", "16"}]]}]}], ";"}], " ", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"converted", " ", "to", " ", "eV"}], ",", " ", 
     RowBox[{
     "wavelength", " ", "calc", " ", "changed", " ", "accordingly"}]}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"me", "=", 
     RowBox[{"0.51099895", "MeV"}]}], ";"}], " ", 
   RowBox[{"(*", 
    RowBox[{
     SuperscriptBox["mc", "2"], " ", "really"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"elecharge", "=", 
     RowBox[{"1.60217662", "*", 
      SuperscriptBox["10", 
       RowBox[{"-", "19"}]]}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.8105297493793077`*^9, 3.810529752462023*^9}, {
  3.8105298517258577`*^9, 
  3.8105298541329737`*^9}},ExpressionUUID->"eb0670cf-8d1f-4e7f-b50c-\
51870fa97b68"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Cases", " ", "-", " ", 
    RowBox[{"CBETA", " ", "150", "MeV", " ", "0.5", "%", " ", "BW"}]}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"CBETA150", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Ee", "\[Rule]", 
       RowBox[{"150", "MeV"}]}], ",", 
      RowBox[{"Q", "\[Rule]", 
       RowBox[{"32", "pC"}]}], ",", 
      RowBox[{"Epulse", "\[Rule]", 
       RowBox[{"62", "\[Mu]J"}]}], ",", 
      RowBox[{"\[Lambda]", "\[Rule]", 
       RowBox[{"1064", "nm"}]}], ",", 
      RowBox[{"\[Theta]col", "\[Rule]", 
       RowBox[{"0.43333", "mrad"}]}], ",", 
      RowBox[{"\[Phi]", "\[Rule]", "0"}], ",", 
      RowBox[{"\[Epsilon]nx", "\[Rule]", 
       RowBox[{"0.3", "mm", " ", "mrad"}]}], ",", 
      RowBox[{"\[Beta]x", "\[Rule]", "0.126176"}], ",", 
      RowBox[{"\[Epsilon]ny", "\[Rule]", 
       RowBox[{"0.3", "mm", " ", "mrad"}]}], ",", 
      RowBox[{"\[Beta]y", "\[Rule]", "0.126176"}], ",", 
      RowBox[{"\[Sigma]L", "\[Rule]", 
       RowBox[{"25", "\[Mu]m"}]}], ",", 
      RowBox[{"\[CapitalDelta]Ee", "\[Rule]", 
       RowBox[{"5", "*", 
        SuperscriptBox["10", 
         RowBox[{"-", "4"}]]}]}], ",", 
      RowBox[{"\[CapitalDelta]k", "\[Rule]", 
       RowBox[{"6.57", "*", 
        SuperscriptBox["10", 
         RowBox[{"-", "4"}]]}]}], ",", 
      RowBox[{"L", "\[Rule]", "10"}], ",", 
      RowBox[{"dE\[Gamma]", "\[Rule]", "200"}]}], "}"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.810529760487592*^9, 3.8105298116230392`*^9}, {
  3.810529859699112*^9, 3.810529973509409*^9}, {3.8105300783059497`*^9, 
  3.810530080455551*^9}, {3.8105325504675465`*^9, 3.8105325791940937`*^9}, {
  3.8105328196372013`*^9, 3.8105328368464193`*^9}, {3.810532914700041*^9, 
  3.8105329273975224`*^9}, {3.810635165493055*^9, 
  3.810635171784951*^9}},ExpressionUUID->"78274ea2-4074-44ab-b60e-\
c38b34777866"],

Cell["\<\
dE\[Gamma] is the energy step in eV between each sampled point in the \
distribution in eV, Ee is the kinetic energy of the electron beam. \
\[CapitalDelta]k is the laser wavenumber spread (just laser energy spread as \
proportional). \
\>", "Text",
 CellChangeTimes->{{3.8105300015758142`*^9, 3.8105300102343636`*^9}, {
  3.810530083758421*^9, 3.8105300996554203`*^9}, {3.810532932519763*^9, 
  3.8105329749230633`*^9}, {3.8140824423999715`*^9, 
  3.8140824433736997`*^9}},ExpressionUUID->"5a7255cc-4cb7-4315-aa47-\
649dd4320a6e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"trialcase", "=", "CBETA150"}], ";"}]], "Input",
 CellChangeTimes->{{3.8105300258077087`*^9, 
  3.810530030924526*^9}},ExpressionUUID->"88085e3a-c9bd-487d-9f11-\
8a678445720b"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Polarisation", "Section",
 CellChangeTimes->{{3.810545884794842*^9, 
  3.8105458871073313`*^9}},ExpressionUUID->"73306ef9-b535-4255-bfaa-\
26c2b011dfb3"],

Cell[TextData[{
 " The polarisation term is negligible for the case where the polarisation is \
in the x-axis of the scattering plane (my answer) or we can notice the term \
vanishes at ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["\[Theta]", "f"], TraditionalForm]],ExpressionUUID->
  "6a5a21bf-69af-4a86-81e7-1cfcc7b5731f"],
 " goes to zero, i.e. in the forward direction. This means you can just drop \
the term entirely and it won\[CloseCurlyQuote]t make much difference in the \
final result (Geoff\[CloseCurlyQuote]s answer). By this line of reasoning we \
can set \[Tau], the azimuthal angle of the linear polarisation ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["P", "t"], TraditionalForm]],ExpressionUUID->
  "b09920d4-40bf-4e9a-8e71-2e3a2a73c72f"],
 " with respect to the ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["x", 
    RowBox[{"e", " "}]], TraditionalForm]],ExpressionUUID->
  "f768d024-342f-4e41-81de-19ac5d6135a1"],
 "axis to zero and set ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["\[Phi]", "f"], TraditionalForm]],ExpressionUUID->
  "9d56aab5-4e28-49a7-88a2-90c99d3d8633"],
 ", the azimuthal angle of the scattering plane to zero. \[Tau] = 0 , ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Phi]", "f"], " ", "=", "0"}], TraditionalForm]],
  ExpressionUUID->"0f3f60f8-bab9-4ea2-99fc-831d096c2615"]
}], "Text",
 CellChangeTimes->{{3.8105459249417176`*^9, 
  3.8105460531924124`*^9}},ExpressionUUID->"7d905146-42f5-4912-9329-\
98e166c94607"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[Tau]", "=", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Phi]f", "=", "0"}], ";"}]}], "Input",
 CellChangeTimes->{{3.8105460590574503`*^9, 
  3.8105460705095224`*^9}},ExpressionUUID->"ca85d083-699b-410f-b9b2-\
f2c91e543445"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Scattered Photon Energy Intermediaries", "Section",
 CellChangeTimes->{{3.810530111251524*^9, 
  3.810530121228568*^9}},ExpressionUUID->"f79b353f-495c-44e0-8fd1-\
109668ba2a83"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"\[Gamma]", "[", "Ee_", "]"}], ":=", 
   FractionBox[
    RowBox[{"Ee", "+", "me"}], "me"]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Beta]", "[", "Ee_", "]"}], ":=", 
   RowBox[{"Sqrt", "[", 
    RowBox[{"1", "-", 
     FractionBox["1", 
      SuperscriptBox[
       RowBox[{"\[Gamma]", "[", "Ee", "]"}], "2"]]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"EL", "[", "\[Lambda]_", "]"}], ":=", 
    FractionBox[
     RowBox[{"2", "*", "\[Pi]", "*", "hbar", "*", "clight"}], "\[Lambda]"]}], 
   ";"}], 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"in", " ", "eV"}], ",", " ", 
    RowBox[{"hbar", " ", "is", " ", "in", " ", "eV"}], ",", " ", 
    RowBox[{"2", "\[Pi]", " ", "due", " ", "to", " ", "hbar"}]}], 
   "*)"}]}]}], "Input",
 CellChangeTimes->{{3.810530127850417*^9, 3.810530257523576*^9}, {
  3.8116611489843564`*^9, 3.8116612005765395`*^9}, {3.8116617855993133`*^9, 
  3.811661819297525*^9}, {3.811662040389826*^9, 3.8116620984779277`*^9}, {
  3.8117385242849984`*^9, 3.811738545563368*^9}, {3.8117386068226132`*^9, 
  3.811738638791602*^9}, {3.8117387967912593`*^9, 3.811738824592143*^9}, {
  3.811739026844579*^9, 3.8117390374173036`*^9}, {3.8146799919920254`*^9, 
  3.8146801000756903`*^9}, {3.8147837873227997`*^9, 
  3.814783787698518*^9}},ExpressionUUID->"14fbce26-d4ca-47eb-93ea-\
3cbf030842bc"],

Cell[TextData[{
 "EL is the energy of the incident photon in eV. EL is independent of k, this \
is currently used for the \[OpenCurlyDoubleQuote]averaged\
\[CloseCurlyDoubleQuote] values of ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["N", "L"], TraditionalForm]],
  FormatType->"TraditionalForm",ExpressionUUID->
  "2e9bc5c6-95c7-4161-a1c5-7acdb0338ae7"],
 " and ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["z", "R"], TraditionalForm]],
  FormatType->"TraditionalForm",ExpressionUUID->
  "686703f9-fcb8-4832-b401-8719e3a0b4ab"],
 " and also used in the \[OpenCurlyDoubleQuote]averaged\
\[CloseCurlyDoubleQuote] cross section terms."
}], "Text",
 CellChangeTimes->{{3.8117390079284735`*^9, 3.811739125716867*^9}, {
  3.8148590864896708`*^9, 
  3.8148591460428324`*^9}},ExpressionUUID->"f22e5c92-3d4f-4dbb-9588-\
9512c8608a66"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Scattered Photon Energy", "Section",
 CellChangeTimes->{{3.8105320381186647`*^9, 
  3.810532047147565*^9}},ExpressionUUID->"5848973f-df18-4c43-a41b-\
45fc7afb6898"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"E\[Gamma]set", "[", 
    RowBox[{"\[Lambda]_", ",", "Ee_", ",", "\[Phi]_", ",", "\[Theta]obs_"}], 
    "]"}], ":=", 
   FractionBox[
    RowBox[{
     RowBox[{"EL", "[", "\[Lambda]", "]"}], "*", 
     RowBox[{"(", 
      RowBox[{"1", "-", 
       RowBox[{
        RowBox[{"\[Beta]", "[", "Ee", "]"}], "*", 
        RowBox[{"Cos", "[", 
         RowBox[{"\[Pi]", "-", "\[Phi]"}], "]"}]}]}], ")"}]}], 
    RowBox[{"1", "-", 
     RowBox[{
      RowBox[{"\[Beta]", "[", "Ee", "]"}], "*", 
      RowBox[{"Cos", "[", "\[Theta]obs", "]"}]}], "+", 
     RowBox[{
      FractionBox[
       RowBox[{"EL", "[", "\[Lambda]", "]"}], "Ee"], "*", 
      RowBox[{"(", 
       RowBox[{"1", "-", 
        RowBox[{"Cos", "[", 
         RowBox[{"\[Pi]", "-", "\[Phi]", "-", "\[Theta]obs"}], "]"}]}], 
       ")"}]}]}]]}], ";"}]], "Input",
 CellChangeTimes->{{3.810532049178429*^9, 3.810532175889785*^9}, {
  3.8116611909821653`*^9, 3.8116612219168386`*^9}, {3.8117385984022264`*^9, 
  3.8117386017170563`*^9}, {3.811738924722234*^9, 
  3.8117389400364594`*^9}},ExpressionUUID->"474d960b-eeac-40ec-9e02-\
c6ce3bfae19b"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"E\[Gamma]set", "[", 
   RowBox[{"\[Lambda]", ",", "Ee", ",", "\[Phi]", ",", "\[Theta]col"}], "]"}],
   "/.", "trialcase"}]], "Input",
 CellChangeTimes->{{3.8106343274439397`*^9, 3.810634350047614*^9}, {
  3.8112376903073387`*^9, 3.8112376950163417`*^9}, {3.8116613852332597`*^9, 
  3.811661397402194*^9}, {3.8117389436935973`*^9, 
  3.8117389459913616`*^9}},ExpressionUUID->"39f1731c-3f04-43a0-9047-\
eb4237aeeac0"],

Cell[BoxData["396834.19830133324`"], "Output",
 CellChangeTimes->{{3.810634333323152*^9, 3.8106343508689075`*^9}, 
   3.8108754471790214`*^9, 3.8112367589531384`*^9, 3.811237695565631*^9, 
   3.811497335979551*^9, 3.811652250127039*^9, 3.811653064331849*^9, 
   3.811653311756447*^9, 3.8116562677166967`*^9, 3.811657324246516*^9, 
   3.811657441100685*^9, 3.8116575300432806`*^9, 3.8116590653993387`*^9, 
   3.8116606562909365`*^9, 3.81174217460665*^9, 3.81296100601423*^9, 
   3.814082512624962*^9, 3.814681584013219*^9, 3.8146834697259464`*^9, 
   3.8146846268202543`*^9, 3.8147857469394073`*^9, 3.814788148917987*^9, 
   3.8148545120212607`*^9, 3.814854927522156*^9, 3.8148556953205333`*^9, 
   3.81485623220179*^9, 3.81485633601799*^9, 3.8148565776461697`*^9, 
   3.8148568584570513`*^9, 3.8148586128355002`*^9, 3.814859240040307*^9, 
   3.8148631818821125`*^9, 3.814865556606535*^9, 
   3.8148668331949835`*^9},ExpressionUUID->"669b63bf-c5c0-4cf0-9fd2-\
daa4f9bf23b9"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Sun Preliminaries", "Section",
 CellChangeTimes->{{3.8105324372531123`*^9, 
  3.8105324412858543`*^9}},ExpressionUUID->"37fb731a-1f47-4ee8-898e-\
59303288decc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Ne", "[", "Q_", "]"}], ":=", 
   FractionBox["Q", "elecharge"]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NL", "[", 
    RowBox[{"Epulse_", ",", "\[Lambda]_"}], "]"}], ":=", 
   FractionBox["Epulse", 
    RowBox[{
     RowBox[{"EL", "[", "\[Lambda]", "]"}], "*", "elecharge"}]]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Epsilon]x", "[", 
    RowBox[{"Ee_", ",", "\[Epsilon]nx_"}], "]"}], ":=", 
   FractionBox["\[Epsilon]nx", 
    RowBox[{
     RowBox[{"\[Beta]", "[", "Ee", "]"}], "*", 
     RowBox[{"\[Gamma]", "[", "Ee", "]"}]}]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Epsilon]y", "[", 
    RowBox[{"Ee_", ",", "\[Epsilon]ny_"}], "]"}], ":=", 
   FractionBox["\[Epsilon]ny", 
    RowBox[{
     RowBox[{"\[Beta]", "[", "Ee", "]"}], "*", 
     RowBox[{"\[Gamma]", "[", "Ee", "]"}]}]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"zr", "[", 
    RowBox[{"\[Lambda]_", ",", "\[Sigma]L_"}], "]"}], ":=", 
   FractionBox[
    RowBox[{"4", "*", "\[Pi]", "*", 
     SuperscriptBox["\[Sigma]L", "2"]}], "\[Lambda]"]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Sigma]e", "[", 
    RowBox[{"\[CapitalDelta]Ee_", ",", "Ee_"}], "]"}], ":=", 
   RowBox[{"\[CapitalDelta]Ee", "*", "Ee"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"klaser", "[", "\[Lambda]_", "]"}], ":=", 
   FractionBox[
    RowBox[{"2", "\[Pi]"}], "\[Lambda]"]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Sigma]k", "[", 
    RowBox[{"\[CapitalDelta]k_", ",", "\[Lambda]_"}], "]"}], ":=", 
   RowBox[{"\[CapitalDelta]k", "*", 
    RowBox[{"klaser", "[", "\[Lambda]", "]"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.8105324490933595`*^9, 3.8105325375347543`*^9}, {
   3.8105325870777073`*^9, 3.81053272565715*^9}, {3.810532796622795*^9, 
   3.81053280682557*^9}, {3.8105328448136005`*^9, 3.810532907056404*^9}, {
   3.8105330026422167`*^9, 3.810533086190022*^9}, {3.810635140212204*^9, 
   3.810635154271084*^9}, 3.811661144771263*^9, {3.811661406124735*^9, 
   3.811661407256014*^9}, {3.81166149683397*^9, 3.8116615092740374`*^9}, {
   3.811661683545533*^9, 3.811661685085477*^9}, {3.8116617611065903`*^9, 
   3.811661778963517*^9}, {3.811662034615183*^9, 3.8116620354256487`*^9}, {
   3.811662082478421*^9, 3.8116621027035885`*^9}, {3.8116621885902767`*^9, 
   3.8116622104328165`*^9}},ExpressionUUID->"f8cbeea9-2ad4-4dc0-ae9f-\
1f8f97a494ed"],

Cell[TextData[{
 "The ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["\[Sigma]", "k"], TraditionalForm]],
  FormatType->"TraditionalForm",ExpressionUUID->
  "325441fa-9f20-417e-b8b1-061249836c71"],
 " term usage here could be wrong. It is undefined in Sun\[CloseCurlyQuote]s \
works, it has been assumed to mirror the form used for the electron bunch \
energy spread."
}], "Text",
 CellChangeTimes->{{3.81485916140899*^9, 3.8148591618465753`*^9}, {
  3.8148592784016886`*^9, 
  3.814859332395311*^9}},ExpressionUUID->"519f89c2-1ec0-49d8-9be6-\
c3b556101979"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Collimation", "Section",
 CellChangeTimes->{{3.810533119938817*^9, 
  3.810533121726933*^9}},ExpressionUUID->"1e00b6b6-3881-4e8e-8a8d-\
b629c21315e0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"R", "[", 
     RowBox[{"L_", ",", "\[Theta]col_"}], "]"}], ":=", 
    RowBox[{"L", "*", "\[Theta]col"}]}], ";"}], 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Far", " ", "field", " ", "collimation"}], ",", " ", 
    RowBox[{"small", " ", "angle", " ", "approximation"}]}], 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.810533128295144*^9, 3.810533167192817*^9}, {
  3.8105332182864056`*^9, 
  3.8105332294061394`*^9}},ExpressionUUID->"efdcc4aa-8608-4cd1-9179-\
a8c95d678384"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Circular", " ", "Collimation"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"x0", "[", 
      RowBox[{"L_", ",", "\[Theta]col_"}], "]"}], ":=", 
     RowBox[{"R", "[", 
      RowBox[{"L", ",", "\[Theta]col"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"y0", "[", 
      RowBox[{"L_", ",", "\[Theta]col_", ",", "xd_"}], "]"}], ":=", 
     RowBox[{"Re", "[", 
      RowBox[{"Sqrt", "[", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"R", "[", 
          RowBox[{"L", ",", "\[Theta]col"}], "]"}], "2"], "-", 
        SuperscriptBox["xd", "2"]}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Square", " ", "Collimation"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"x0", "[", "A_", "]"}], ":=", "A"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"y0", "[", "B_", "]"}], ":=", "B"}], ";"}], "*)"}]}]}]], "Input",
 CellChangeTimes->{{3.810533233326393*^9, 3.810533411415464*^9}, {
   3.810533484967451*^9, 3.810533526647258*^9}, {3.814683421009845*^9, 
   3.814683424751229*^9}, 3.814683481090801*^9, {3.814854312375798*^9, 
   3.8148543163360944`*^9}, 3.814855637966863*^9, {3.8148562044769793`*^9, 
   3.8148562087911263`*^9}, {3.8148564776493797`*^9, 
   3.8148564786037483`*^9}, {3.814856808450653*^9, 3.814856809135743*^9}, {
   3.814856868212998*^9, 
   3.8148568687309294`*^9}},ExpressionUUID->"c50dd82b-7f3a-4da3-be6a-\
1cd8235e6720"],

Cell[TextData[{
 "Square aperture created in two dimensions ",
 Cell[BoxData[
  FormBox[
   RowBox[{"(", 
    SubscriptBox["x", "0"]}], TraditionalForm]],ExpressionUUID->
  "eaff480a-9a52-47bc-892f-ee1385d05c68"],
 "= A for ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["x", "d"], TraditionalForm]],ExpressionUUID->
  "2c4226c7-a5a2-4365-9a23-e596efb3498f"],
 ", ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["y", "0"], TraditionalForm]],ExpressionUUID->
  "5e6b9201-cbca-430f-8d6b-47a23aa4be13"],
 "=B for ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["x", "d"], TraditionalForm]],ExpressionUUID->
  "56b8cbc2-a922-4937-86e0-b28a98b1ffaf"],
 "), Circular aperture based on the radius ",
 Cell[BoxData[
  FormBox[
   RowBox[{"(", 
    SubscriptBox["x", "0"]}], TraditionalForm]],ExpressionUUID->
  "c096e312-ffae-4026-b928-93037e6c2c1f"],
 "=R for ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["x", "d"], TraditionalForm]],ExpressionUUID->
  "8b2dd98c-12bb-4bd0-b240-03bee85fcd50"],
 ", ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["y", "0"], TraditionalForm]],ExpressionUUID->
  "619293b3-f89e-4a36-aee0-1749a5956a74"],
 "= Re ",
 Cell[BoxData[
  FormBox[
   RowBox[{"Sqrt", "[", 
    RowBox[{
     SuperscriptBox["R", "2"], " ", "-", " ", 
     SuperscriptBox[
      SubscriptBox["x", "d"], "2"]}]}], TraditionalForm]],ExpressionUUID->
  "363b750b-65c7-42ca-8dbb-5c0559faea3f"],
 "] for ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["y", "d"], TraditionalForm]],ExpressionUUID->
  "2627b527-dbf0-4f9d-b6ee-47bf57c8efa8"],
 " or vice versa depending on order of integration).  "
}], "Text",
 CellChangeTimes->{{3.810533569272956*^9, 
  3.8105335977797766`*^9}},ExpressionUUID->"e9e59e34-50e9-42b1-8c05-\
77504d064191"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Sun Intermediaries", "Section",
 CellChangeTimes->{{3.810535154258973*^9, 
  3.8105351598193536`*^9}},ExpressionUUID->"c6182301-d15a-4145-928c-\
6083680aca5d"],

Cell[TextData[{
 "Here we assume collisions are done at a waist i.e ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Alpha]", "x"], "=", 
    SubscriptBox["\[Alpha]", "y"]}], TraditionalForm]],ExpressionUUID->
  "d676a876-45b6-4a10-aee2-09a7543d3343"],
 "= 0. Therefore, the ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["\[Xi]", 
    RowBox[{"x", "/", "y"}]], TraditionalForm]],ExpressionUUID->
  "d7b5f89d-42eb-473a-b60a-5867898e6195"],
 " formula are simplified from Sun\[CloseCurlyQuote]s thesis. "
}], "Text",
 CellChangeTimes->{{3.810535552257547*^9, 
  3.81053565802505*^9}},ExpressionUUID->"a579b177-1ed7-480b-9e2d-\
ab42c8c60908"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"\[Gamma]bar", "[", 
    RowBox[{
    "\[Lambda]_", ",", "E\[Gamma]_", ",", "\[Theta]x_", ",", "\[Theta]y_"}], 
    "]"}], ":=", 
   RowBox[{
    FractionBox[
     RowBox[{"2", "*", "E\[Gamma]", "*", 
      RowBox[{"EL", "[", "\[Lambda]", "]"}]}], 
     RowBox[{"me", "*", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"4", "*", 
         RowBox[{"EL", "[", "\[Lambda]", "]"}]}], "-", 
        RowBox[{"E\[Gamma]", "*", 
         RowBox[{"(", 
          RowBox[{
           SuperscriptBox["\[Theta]x", "2"], "+", 
           SuperscriptBox["\[Theta]y", "2"]}], ")"}]}]}], ")"}]}]], "*", 
    RowBox[{"(", 
     RowBox[{"1", "+", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"1", "+", 
        FractionBox[
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"4", "*", 
             RowBox[{"EL", "[", "\[Lambda]", "]"}]}], "-", 
            RowBox[{"E\[Gamma]", "*", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Theta]x", "2"], "+", 
               SuperscriptBox["\[Theta]y", "2"]}], ")"}]}]}], ")"}], "*", 
          SuperscriptBox["me", "2"]}], 
         RowBox[{"4", "*", 
          SuperscriptBox[
           RowBox[{"EL", "[", "\[Lambda]", "]"}], "2"], "*", "E\[Gamma]"}]]}],
        "]"}]}], ")"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Xi]x", "[", 
    RowBox[{
    "\[Beta]x_", ",", "L_", ",", "k_", ",", "Ee_", ",", "\[Epsilon]nx_", ",", 
     "\[Lambda]_", ",", "\[Sigma]L_"}], "]"}], ":=", 
   RowBox[{"1", "+", 
    SuperscriptBox[
     RowBox[{"(", 
      FractionBox["\[Beta]x", "L"], ")"}], "2"], "+", 
    FractionBox[
     RowBox[{"2", "*", "k", "*", "\[Beta]x", "*", 
      RowBox[{"\[Epsilon]x", "[", 
       RowBox[{"Ee", ",", "\[Epsilon]nx"}], "]"}]}], 
     RowBox[{"zr", "[", 
      RowBox[{"\[Lambda]", ",", "\[Sigma]L"}], "]"}]]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Xi]y", "[", 
    RowBox[{
    "\[Beta]y_", ",", "L_", ",", "k_", ",", "Ee_", ",", "\[Epsilon]ny_", ",", 
     "\[Lambda]_", ",", "\[Sigma]L_"}], "]"}], ":=", 
   RowBox[{"1", "+", 
    SuperscriptBox[
     RowBox[{"(", 
      FractionBox["\[Beta]y", "L"], ")"}], "2"], "+", 
    FractionBox[
     RowBox[{"2", "*", "k", "*", "\[Beta]y", "*", 
      RowBox[{"\[Epsilon]y", "[", 
       RowBox[{"Ee", ",", "\[Epsilon]ny"}], "]"}]}], 
     RowBox[{"zr", "[", 
      RowBox[{"\[Lambda]", ",", "\[Sigma]L"}], "]"}]]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Zeta]x", "[", 
    RowBox[{
    "k_", ",", "\[Beta]x_", ",", "Ee_", ",", "\[Epsilon]nx_", ",", 
     "\[Lambda]_", ",", "\[Sigma]L_"}], "]"}], ":=", 
   RowBox[{"1", "+", 
    FractionBox[
     RowBox[{"2", "*", "k", "*", "\[Beta]x", "*", 
      RowBox[{"\[Epsilon]x", "[", 
       RowBox[{"Ee", ",", "\[Epsilon]nx"}], "]"}]}], 
     RowBox[{"zr", "[", 
      RowBox[{"\[Lambda]", ",", "\[Sigma]L"}], "]"}]]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Zeta]y", "[", 
    RowBox[{
    "k_", ",", "\[Beta]y_", ",", "Ee_", ",", "\[Epsilon]ny_", ",", 
     "\[Lambda]_", ",", "\[Sigma]L_"}], "]"}], ":=", 
   RowBox[{"1", "+", 
    FractionBox[
     RowBox[{"2", "*", "k", "*", "\[Beta]y", "*", 
      RowBox[{"\[Epsilon]y", "[", 
       RowBox[{"Ee", ",", "\[Epsilon]ny"}], "]"}]}], 
     RowBox[{"zr", "[", 
      RowBox[{"\[Lambda]", ",", "\[Sigma]L"}], "]"}]]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Sigma]\[Theta]x", "[", 
    RowBox[{
    "Ee_", ",", "\[Epsilon]nx_", ",", "\[Beta]x_", ",", "L_", ",", "k_", ",", 
     "\[Lambda]_", ",", "\[Sigma]L_"}], "]"}], ":=", 
   RowBox[{"Sqrt", "[", 
    FractionBox[
     RowBox[{
      RowBox[{"\[Epsilon]x", "[", 
       RowBox[{"Ee", ",", "\[Epsilon]nx"}], "]"}], "*", 
      RowBox[{"\[Xi]x", "[", 
       RowBox[{
       "\[Beta]x", ",", "L", ",", "k", ",", "Ee", ",", "\[Epsilon]nx", ",", 
        "\[Lambda]", ",", "\[Sigma]L"}], "]"}]}], 
     RowBox[{"\[Beta]x", "*", 
      RowBox[{"\[Zeta]x", "[", 
       RowBox[{
       "k", ",", "\[Beta]x", ",", "Ee", ",", "\[Epsilon]nx", ",", "\[Lambda]",
         ",", "\[Sigma]L"}], "]"}]}]], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Sigma]\[Theta]y", "[", 
    RowBox[{
    "Ee_", ",", "\[Epsilon]ny_", ",", "\[Beta]y_", ",", "L_", ",", "k_", ",", 
     "\[Lambda]_", ",", "\[Sigma]L_"}], "]"}], ":=", 
   RowBox[{"Sqrt", "[", 
    FractionBox[
     RowBox[{
      RowBox[{"\[Epsilon]y", "[", 
       RowBox[{"Ee", ",", "\[Epsilon]ny"}], "]"}], "*", 
      RowBox[{"\[Xi]y", "[", 
       RowBox[{
       "\[Beta]y", ",", "L", ",", "k", ",", "Ee", ",", "\[Epsilon]ny", ",", 
        "\[Lambda]", ",", "\[Sigma]L"}], "]"}]}], 
     RowBox[{"\[Beta]y", "*", 
      RowBox[{"\[Zeta]y", "[", 
       RowBox[{
       "k", ",", "\[Beta]y", ",", "Ee", ",", "\[Epsilon]ny", ",", "\[Lambda]",
         ",", "\[Sigma]L"}], "]"}]}]], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Sigma]\[Gamma]", "[", 
    RowBox[{"\[CapitalDelta]Ee_", ",", "Ee_"}], "]"}], ":=", 
   FractionBox[
    RowBox[{"\[Sigma]e", "[", 
     RowBox[{"\[CapitalDelta]Ee", ",", "Ee"}], "]"}], "me"]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Theta]ymax", "[", 
    RowBox[{"\[Lambda]_", ",", "E\[Gamma]_"}], "]"}], ":=", 
   RowBox[{"Sqrt", "[", 
    FractionBox[
     RowBox[{"4", "*", 
      RowBox[{"EL", "[", "\[Lambda]", "]"}]}], "E\[Gamma]"], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Theta]xmax", "[", 
    RowBox[{"\[Lambda]_", ",", "E\[Gamma]_", ",", "\[Theta]y_"}], "]"}], ":=", 
   RowBox[{"Sqrt", "[", 
    RowBox[{
     FractionBox[
      RowBox[{"4", "*", 
       RowBox[{"EL", "[", "\[Lambda]", "]"}]}], "E\[Gamma]"], "-", 
     SuperscriptBox["\[Theta]y", "2"]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.810535162375991*^9, 3.810535300308116*^9}, {
   3.810535347206051*^9, 3.8105354903243637`*^9}, {3.8105356688827095`*^9, 
   3.810535690254238*^9}, {3.810535803017893*^9, 3.810536168713853*^9}, {
   3.810536217577236*^9, 3.810536678720002*^9}, {3.8105521979871016`*^9, 
   3.810552250631813*^9}, {3.8111553260462093`*^9, 3.8111553356054296`*^9}, {
   3.8116532018945656`*^9, 3.811653209195535*^9}, {3.8116597413798676`*^9, 
   3.8116598931286173`*^9}, {3.8116607305517664`*^9, 
   3.8116607361850667`*^9}, {3.8116615205799885`*^9, 
   3.8116616706425905`*^9}, {3.811662122521351*^9, 3.81166218155276*^9}, {
   3.8116622189066877`*^9, 3.811662231348239*^9}, {3.8117394494983053`*^9, 
   3.811739473759983*^9}, {3.8117395089197655`*^9, 3.8117395094888396`*^9}, {
   3.811741044870037*^9, 3.811741159852143*^9}, {3.8117412039772625`*^9, 
   3.8117412084591646`*^9}, {3.8117412498879957`*^9, 3.811741277584361*^9}, 
   3.8146846063179665`*^9, 3.8146846698926463`*^9, {3.81478381084279*^9, 
   3.8147839323305306`*^9}, {3.81478397959453*^9, 3.8147839938534946`*^9}, {
   3.814854406026721*^9, 3.814854409487261*^9}, {3.8148548317129326`*^9, 
   3.814854860161936*^9}, {3.814855601097653*^9, 
   3.8148556315787077`*^9}},ExpressionUUID->"4c95d470-1795-4e28-8701-\
6767394f65c5"],

Cell["\<\
The limits of integration have both been constructed using EL i.e the \
constant case. I\[CloseCurlyQuote]m unsure whether this is correct? Feels \
slightly incorrect, but simpler to get code running like this.\
\>", "Text",
 CellChangeTimes->{{3.811741288356347*^9, 3.811741363277727*^9}, {
  3.814854934076112*^9, 3.8148549371499186`*^9}, {3.8148655615042925`*^9, 
  3.814865562649831*^9}},ExpressionUUID->"f0243cbe-dae8-4a0e-aa2b-\
050072e394fa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"kmin", "[", 
    RowBox[{"\[Lambda]_", ",", "\[CapitalDelta]k_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"klaser", "[", "\[Lambda]", "]"}], "*", 
    RowBox[{"(", 
     RowBox[{"1", "-", 
      RowBox[{"3", "*", "\[CapitalDelta]k"}]}], ")"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"kmax", "[", 
    RowBox[{"\[Lambda]_", ",", "\[CapitalDelta]k_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"klaser", "[", "\[Lambda]", "]"}], "*", 
    RowBox[{"(", 
     RowBox[{"1", "+", 
      RowBox[{"3", "*", "\[CapitalDelta]k"}]}], ")"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.8147849623105288`*^9, 
  3.8147850494099846`*^9}},ExpressionUUID->"48f7935f-38b0-41e8-9a60-\
e9d30415ea8d"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Prefactor", "Section",
 CellChangeTimes->{{3.810536721951971*^9, 
  3.8105367240511665`*^9}},ExpressionUUID->"b135858d-9011-4e0b-b9e8-\
ec69df382cbb"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"prefactor", "[", 
    RowBox[{
    "Q_", ",", "Epulse_", ",", "\[Lambda]_", ",", "\[Sigma]L_", ",", 
     "\[CapitalDelta]Ee_", ",", "Ee_", ",", "\[CapitalDelta]k_", ",", "L_"}], 
    "]"}], ":=", 
   FractionBox[
    RowBox[{
     SuperscriptBox["re", "2"], "*", 
     RowBox[{"Ne", "[", "Q", "]"}], "*", 
     RowBox[{"NL", "[", 
      RowBox[{"Epulse", ",", "\[Lambda]"}], "]"}]}], 
    RowBox[{"4", "*", 
     SuperscriptBox["\[Pi]", "3"], "*", "hbar", "*", "clight", "*", 
     RowBox[{"zr", "[", 
      RowBox[{"\[Lambda]", ",", "\[Sigma]L"}], "]"}], "*", 
     RowBox[{"\[Sigma]\[Gamma]", "[", 
      RowBox[{"\[CapitalDelta]Ee", ",", "Ee"}], "]"}], "*", 
     RowBox[{"\[Sigma]k", "[", 
      RowBox[{"\[CapitalDelta]k", ",", "\[Lambda]"}], "]"}], "*", 
     SuperscriptBox["L", "2"]}]]}], ";"}]], "Input",
 CellChangeTimes->{{3.8105367283387327`*^9, 3.810536832839019*^9}, {
   3.810544852729499*^9, 3.810544996293228*^9}, {3.8106243547439985`*^9, 
   3.8106243564466753`*^9}, {3.8106351210738344`*^9, 3.8106351311645803`*^9}, 
   3.8116617289103727`*^9, {3.811661842333403*^9, 
   3.8116618504493685`*^9}},ExpressionUUID->"44a58f3f-cd50-4df1-938b-\
1f9d9025910f"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"prefactor", "[", 
    RowBox[{
    "Q", ",", "Epulse", ",", "\[Lambda]", ",", "\[Sigma]L", ",", 
     "\[CapitalDelta]Ee", ",", "Ee", ",", "\[CapitalDelta]k", ",", "L"}], 
    "]"}], "/.", "trialcase"}], "//", "ScientificForm"}]], "Input",
 CellChangeTimes->{{3.810635044823655*^9, 3.810635105187126*^9}, 
   3.8106352036191545`*^9, {3.810875468192519*^9, 
   3.8108754771227713`*^9}},ExpressionUUID->"133f7a76-249b-414e-9ad1-\
5f9f8cb3d402"],

Cell[BoxData[
 TagBox[
  InterpretationBox[
   RowBox[{"\<\"5.12004\"\>", "\[Times]", 
    SuperscriptBox["10", "\<\"-5\"\>"]}],
   0.000051200375394841823`,
   AutoDelete->True],
  ScientificForm]], "Output",
 CellChangeTimes->{
  3.810635106056204*^9, {3.810875458365121*^9, 3.810875477985116*^9}, 
   3.8108765130698996`*^9, 3.811236777282712*^9, 3.8114973460138493`*^9, 
   3.811652261781409*^9, 3.8116530805119753`*^9, 3.811653321396462*^9, 
   3.811657334234427*^9, 3.8116574494236937`*^9, 3.811657541225485*^9, 
   3.811659074367831*^9, 3.811660664179669*^9, 3.8117421853172274`*^9, 
   3.8129610171880636`*^9, 3.8140825256931934`*^9, 3.8146834884339952`*^9, 
   3.814684637889227*^9, 3.8147857605729613`*^9, 3.814788162150072*^9, 
   3.814854522817255*^9, 3.8148549413963356`*^9, 3.814855705276571*^9, 
   3.814856240868552*^9, 3.814856587495764*^9, 3.8148568774490285`*^9, 
   3.814858684288311*^9, 3.8148592492678967`*^9, 3.814865566491523*^9, 
   3.8148668444543934`*^9},ExpressionUUID->"605f9715-4e96-4798-a241-\
6d053c0f4e63"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Separated Integral Terms", "Section",
 CellChangeTimes->{{3.8105450633543177`*^9, 
  3.81054507086644*^9}},ExpressionUUID->"c54aade0-d934-4102-8eed-\
9f6b9a459f98"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"term1", "[", 
    RowBox[{
    "k_", ",", "\[Beta]x_", ",", "Ee_", ",", "\[Epsilon]nx_", ",", 
     "\[Lambda]_", ",", "\[Beta]y_", ",", "\[Epsilon]ny_", ",", "L_", ",", 
     "\[Sigma]L_"}], "]"}], ":=", 
   FractionBox["1", 
    RowBox[{
     RowBox[{"Sqrt", "[", 
      RowBox[{
       RowBox[{"\[Zeta]x", "[", 
        RowBox[{
        "k", ",", "\[Beta]x", ",", "Ee", ",", "\[Epsilon]nx", ",", 
         "\[Lambda]", ",", "\[Sigma]L"}], "]"}], "*", 
       RowBox[{"\[Zeta]y", "[", 
        RowBox[{
        "k", ",", "\[Beta]y", ",", "Ee", ",", "\[Epsilon]ny", ",", 
         "\[Lambda]", ",", "\[Sigma]L"}], "]"}]}], "]"}], "*", 
     RowBox[{"\[Sigma]\[Theta]x", "[", 
      RowBox[{
      "Ee", ",", "\[Epsilon]nx", ",", "\[Beta]x", ",", "L", ",", "k", ",", 
       "\[Lambda]", ",", "\[Sigma]L"}], "]"}], "*", 
     RowBox[{"\[Sigma]\[Theta]y", "[", 
      RowBox[{
      "Ee", ",", "\[Epsilon]ny", ",", "\[Beta]y", ",", "L", ",", "k", ",", 
       "\[Lambda]", ",", "\[Sigma]L"}], "]"}]}]]}], ";"}]], "Input",
 CellChangeTimes->{{3.810545072206974*^9, 3.8105451558998203`*^9}, {
   3.8105453474920835`*^9, 3.8105454297914543`*^9}, {3.8105455704037046`*^9, 
   3.8105456214207177`*^9}, {3.811659905841261*^9, 3.8116599504481444`*^9}, {
   3.8147875019689255`*^9, 3.814787519474674*^9}, {3.8147881064619045`*^9, 
   3.814788119879692*^9}, 3.8148548045809684`*^9, 
   3.8148555075292263`*^9},ExpressionUUID->"f8442268-537c-4362-981e-\
dfe1244b5cfc"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"term2", "[", 
    RowBox[{
    "\[Lambda]_", ",", "E\[Gamma]_", ",", "\[Theta]x_", ",", "\[Theta]y_"}], 
    "]"}], ":=", 
   FractionBox[
    RowBox[{"\[Gamma]bar", "[", 
     RowBox[{
     "\[Lambda]", ",", "E\[Gamma]", ",", "\[Theta]x", ",", "\[Theta]y"}], 
     "]"}], 
    RowBox[{"1", "+", 
     FractionBox[
      RowBox[{"2", "*", 
       RowBox[{"\[Gamma]bar", "[", 
        RowBox[{
        "\[Lambda]", ",", "E\[Gamma]", ",", "\[Theta]x", ",", "\[Theta]y"}], 
        "]"}], "*", 
       RowBox[{"EL", "[", "\[Lambda]", "]"}]}], "me"]}]]}], ";"}]], "Input",
 CellChangeTimes->{{3.810545652796437*^9, 3.810545787951338*^9}, {
   3.8117417831811004`*^9, 3.811741801272314*^9}, 3.8146816570062466`*^9, {
   3.8147840893090796`*^9, 3.8147841139286327`*^9}, {3.8147875263214636`*^9, 
   3.814787528599264*^9}, {3.8148547546125526`*^9, 3.8148547566181345`*^9}, {
   3.814855499843313*^9, 
   3.8148555036472683`*^9}},ExpressionUUID->"e60fd43d-c1ae-4676-9f39-\
e09d48af13bb"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"term3", "[", 
    RowBox[{
    "\[Lambda]_", ",", "E\[Gamma]_", ",", "\[Theta]x_", ",", "\[Theta]y_", 
     ",", "\[Tau]_", ",", "\[Phi]f_"}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      FractionBox["1", "4"], "*", 
      RowBox[{"(", 
       RowBox[{
        FractionBox[
         RowBox[{"4", "*", 
          SuperscriptBox[
           RowBox[{"\[Gamma]bar", "[", 
            RowBox[{
            "\[Lambda]", ",", "E\[Gamma]", ",", "\[Theta]x", ",", 
             "\[Theta]y"}], "]"}], "2"], "*", 
          RowBox[{"EL", "[", "\[Lambda]", "]"}]}], 
         RowBox[{"E\[Gamma]", "*", 
          RowBox[{"(", 
           RowBox[{"1", "+", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"\[Gamma]bar", "[", 
               RowBox[{
               "\[Lambda]", ",", "E\[Gamma]", ",", "\[Theta]x", ",", 
                "\[Theta]y"}], "]"}], "2"], "*", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Theta]x", "2"], "+", 
               SuperscriptBox["\[Theta]y", "2"]}], ")"}]}]}], ")"}]}]], "+", 
        FractionBox[
         RowBox[{"E\[Gamma]", "*", 
          RowBox[{"(", 
           RowBox[{"1", "+", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"\[Gamma]bar", "[", 
               RowBox[{
               "\[Lambda]", ",", "E\[Gamma]", ",", "\[Theta]x", ",", 
                "\[Theta]y"}], "]"}], "2"], "*", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["\[Theta]x", "2"], "+", 
               SuperscriptBox["\[Theta]y", "2"]}], ")"}]}]}], ")"}]}], 
         RowBox[{"4", "*", 
          SuperscriptBox[
           RowBox[{"\[Gamma]bar", "[", 
            RowBox[{
            "\[Lambda]", ",", "E\[Gamma]", ",", "\[Theta]x", ",", 
             "\[Theta]y"}], "]"}], "2"], "*", 
          RowBox[{"EL", "[", "\[Lambda]", "]"}]}]]}], ")"}]}], "-", 
     RowBox[{"2", "*", 
      SuperscriptBox[
       RowBox[{"Cos", "[", 
        RowBox[{"\[Tau]", "-", "\[Phi]f"}], "]"}], "2"], "*", 
      FractionBox[
       RowBox[{
        SuperscriptBox[
         RowBox[{"\[Gamma]bar", "[", 
          RowBox[{
          "\[Lambda]", ",", "E\[Gamma]", ",", "\[Theta]x", ",", "\[Theta]y"}],
           "]"}], "2"], "*", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Theta]x", "2"], "+", 
          SuperscriptBox["\[Theta]y", "2"]}], ")"}]}], 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{"1", "+", 
          RowBox[{
           SuperscriptBox[
            RowBox[{"\[Gamma]bar", "[", 
             RowBox[{
             "\[Lambda]", ",", "E\[Gamma]", ",", "\[Theta]x", ",", 
              "\[Theta]y"}], "]"}], "2"], "*", 
           RowBox[{"(", 
            RowBox[{
             SuperscriptBox["\[Theta]x", "2"], "+", 
             SuperscriptBox["\[Theta]y", "2"]}], ")"}]}]}], ")"}], "2"]]}]}], 
    ")"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.810545793671461*^9, 3.8105457950093184`*^9}, {
  3.810545853684869*^9, 3.81054586125133*^9}, {3.810546078479748*^9, 
  3.8105460796309505`*^9}, {3.810546364860407*^9, 3.810546631637266*^9}, {
  3.8105467073306713`*^9, 3.8105468891538224`*^9}, {3.8116589910740495`*^9, 
  3.8116590009359093`*^9}, {3.811741809440384*^9, 3.8117418535681047`*^9}, {
  3.814783630680582*^9, 3.8147837020071335`*^9}, {3.814784120766078*^9, 
  3.814784235999193*^9}, {3.814784277329661*^9, 3.8147843011739707`*^9}, {
  3.8147844108648243`*^9, 3.81478441862464*^9}, {3.8147875326646323`*^9, 
  3.8147875356503906`*^9}, {3.814854762419002*^9, 3.814854764685549*^9}, {
  3.814855478194085*^9, 
  3.8148554963580127`*^9}},ExpressionUUID->"8e8e441e-12fb-4240-a2b0-\
5f1d7aae10ee"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"term4", "[", 
    RowBox[{
    "\[Theta]x_", ",", "xd_", ",", "L_", ",", "Ee_", ",", "\[Epsilon]nx_", 
     ",", "\[Beta]x_", ",", "k_", ",", "\[Lambda]_", ",", "\[Theta]y_", ",", 
     "yd_", ",", "\[Epsilon]ny_", ",", "\[Beta]y_", ",", "E\[Gamma]_", ",", 
     "\[CapitalDelta]Ee_", ",", "\[CapitalDelta]k_", ",", "\[Sigma]L_"}], 
    "]"}], ":=", 
   RowBox[{"Exp", "[", 
    RowBox[{
     RowBox[{"-", 
      FractionBox[
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{"\[Theta]x", "-", 
          FractionBox["xd", "L"]}], ")"}], "2"], 
       RowBox[{"2", "*", 
        SuperscriptBox[
         RowBox[{"\[Sigma]\[Theta]x", "[", 
          RowBox[{
          "Ee", ",", "\[Epsilon]nx", ",", "\[Beta]x", ",", "L", ",", "k", ",",
            "\[Lambda]", ",", "\[Sigma]L"}], "]"}], "2"]}]]}], "-", 
     FractionBox[
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"\[Theta]y", "-", 
         FractionBox["yd", "L"]}], ")"}], "2"], 
      RowBox[{"2", "*", 
       SuperscriptBox[
        RowBox[{"\[Sigma]\[Theta]y", "[", 
         RowBox[{
         "Ee", ",", "\[Epsilon]ny", ",", "\[Beta]y", ",", "L", ",", "k", ",", 
          "\[Lambda]", ",", "\[Sigma]L"}], "]"}], "2"]}]], "-", 
     FractionBox[
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"\[Gamma]bar", "[", 
          RowBox[{
          "\[Lambda]", ",", "E\[Gamma]", ",", "\[Theta]x", ",", "\[Theta]y"}],
           "]"}], "-", 
         RowBox[{"\[Gamma]", "[", "Ee", "]"}]}], ")"}], "2"], 
      RowBox[{"2", "*", 
       SuperscriptBox[
        RowBox[{"\[Sigma]\[Gamma]", "[", 
         RowBox[{"\[CapitalDelta]Ee", ",", "Ee"}], "]"}], "2"]}]], "-", 
     FractionBox[
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"k", "-", 
         RowBox[{"klaser", "[", "\[Lambda]", "]"}]}], ")"}], "2"], 
      RowBox[{"2", "*", 
       SuperscriptBox[
        RowBox[{"\[Sigma]k", "[", 
         RowBox[{"\[CapitalDelta]k", ",", "\[Lambda]"}], "]"}], "2"]}]]}], 
    "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8105468951184993`*^9, 3.8105468963006897`*^9}, {
  3.810547001853937*^9, 3.8105473945257382`*^9}, {3.8105474478703995`*^9, 
  3.8105475328228326`*^9}, {3.8116599653478713`*^9, 3.8116599930714645`*^9}, {
  3.811742014267282*^9, 3.8117420159148846`*^9}, {3.811742077376526*^9, 
  3.81174207787415*^9}, {3.814784314108327*^9, 3.814784316774437*^9}, {
  3.814854768346907*^9, 3.8148547869698496`*^9}, {3.8148554820058117`*^9, 
  3.8148554924776244`*^9}},ExpressionUUID->"8700b1b8-6c92-4388-a561-\
3238d3080147"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Integral Term", "Section",
 CellChangeTimes->{{3.814784349821698*^9, 
  3.8147843524525604`*^9}},ExpressionUUID->"497caded-e072-43e3-bfba-\
4c32a248c4b6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"intterm", "[", 
   RowBox[{
   "k_", ",", "\[Beta]x_", ",", "Ee_", ",", "\[Epsilon]nx_", ",", 
    "\[Lambda]_", ",", "\[Beta]y_", ",", "\[Epsilon]ny_", ",", "L_", ",", 
    "\[Sigma]L_", ",", "E\[Gamma]_", ",", "\[Theta]x_", ",", "\[Theta]y_", 
    ",", "\[Tau]_", ",", "\[Phi]f_", ",", "xd_", ",", "yd_", ",", 
    "\[CapitalDelta]Ee_", ",", "\[CapitalDelta]k_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"term1", "[", 
    RowBox[{
    "k", ",", "\[Beta]x", ",", "Ee", ",", "\[Epsilon]nx", ",", "\[Lambda]", 
     ",", "\[Beta]y", ",", "\[Epsilon]ny", ",", "L", ",", "\[Sigma]L"}], 
    "]"}], "*", 
   RowBox[{"term2", "[", 
    RowBox[{
    "\[Lambda]", ",", "E\[Gamma]", ",", "\[Theta]x", ",", "\[Theta]y"}], 
    "]"}], "*", 
   RowBox[{"term3", "[", 
    RowBox[{
    "\[Lambda]", ",", "E\[Gamma]", ",", "\[Theta]x", ",", "\[Theta]y", ",", 
     "\[Tau]", ",", "\[Phi]f"}], "]"}], "*", 
   RowBox[{"term4", "[", 
    RowBox[{
    "\[Theta]x", ",", "xd", ",", "L", ",", "Ee", ",", "\[Epsilon]nx", ",", 
     "\[Beta]x", ",", "k", ",", "\[Lambda]", ",", "\[Theta]y", ",", "yd", ",",
      "\[Epsilon]ny", ",", "\[Beta]y", ",", "E\[Gamma]", ",", 
     "\[CapitalDelta]Ee", ",", "\[CapitalDelta]k", ",", "\[Sigma]L"}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.814784354986183*^9, 3.814784425129058*^9}, {
  3.814784463792139*^9, 3.814784606801846*^9}, {3.8148546619420424`*^9, 
  3.8148546771404366`*^9}, {3.8148547142508554`*^9, 3.81485472460032*^9}, {
  3.8148557579513345`*^9, 3.8148557640300894`*^9}, {3.8148558046594195`*^9, 
  3.81485581409156*^9}, {3.814856042118786*^9, 
  3.8148560457690983`*^9}},ExpressionUUID->"330e0fd1-102e-4bc5-8f6d-\
a0a531ea1c4c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"INTterm", "[", 
    RowBox[{
    "\[Beta]x_", ",", "Ee_", ",", "\[Epsilon]nx_", ",", "\[Lambda]_", ",", 
     "\[Beta]y_", ",", "\[Epsilon]ny_", ",", "L_", ",", "\[Sigma]L_", ",", 
     "E\[Gamma]_", ",", "\[Tau]_", ",", "\[Phi]f_", ",", "\[CapitalDelta]Ee_",
      ",", "\[CapitalDelta]k_"}], "]"}], ":=", 
   RowBox[{"NIntegrate", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"intterm", "[", 
       RowBox[{
       "k", ",", "\[Beta]x", ",", "Ee", ",", "\[Epsilon]nx", ",", "\[Lambda]",
         ",", "\[Beta]y", ",", "\[Epsilon]ny", ",", "L", ",", "\[Sigma]L", 
        ",", "E\[Gamma]", ",", "\[Theta]x", ",", "\[Theta]y", ",", "\[Tau]", 
        ",", "\[Phi]f", ",", "xd", ",", "yd", ",", "\[CapitalDelta]Ee", ",", 
        "\[CapitalDelta]k"}], "]"}], "/.", "trialcase"}], ",", 
     RowBox[{"{", 
      RowBox[{"xd", ",", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"x0", "[", 
          RowBox[{"L", ",", "\[Theta]col"}], "]"}]}], "/.", "trialcase"}], 
       ",", 
       RowBox[{
        RowBox[{"x0", "[", 
         RowBox[{"L", ",", "\[Theta]col"}], "]"}], "/.", "trialcase"}]}], 
      "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"yd", ",", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"y0", "[", 
          RowBox[{"L", ",", "\[Theta]col", ",", "xd"}], "]"}]}], "/.", 
        "trialcase"}], ",", 
       RowBox[{
        RowBox[{"y0", "[", 
         RowBox[{"L", ",", "\[Theta]col", ",", "xd"}], "]"}], "/.", 
        "trialcase"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\[Theta]y", ",", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"\[Theta]ymax", "[", 
          RowBox[{"\[Lambda]", ",", "E\[Gamma]"}], "]"}]}], "/.", 
        "trialcase"}], ",", 
       RowBox[{
        RowBox[{"\[Theta]ymax", "[", 
         RowBox[{"\[Lambda]", ",", "E\[Gamma]"}], "]"}], "/.", 
        "trialcase"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\[Theta]x", ",", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"\[Theta]xmax", "[", 
          RowBox[{"\[Lambda]", ",", "E\[Gamma]", ",", "\[Theta]y"}], "]"}]}], 
        "/.", "trialcase"}], ",", 
       RowBox[{
        RowBox[{"\[Theta]xmax", "[", 
         RowBox[{"\[Lambda]", ",", "E\[Gamma]", ",", "\[Theta]y"}], "]"}], "/.",
         "trialcase"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", 
       RowBox[{
        RowBox[{"kmin", "[", 
         RowBox[{"\[Lambda]", ",", "\[CapitalDelta]k"}], "]"}], "/.", 
        "trialcase"}], ",", 
       RowBox[{
        RowBox[{"kmax", "[", 
         RowBox[{"\[Lambda]", ",", "\[CapitalDelta]k"}], "]"}], "/.", 
        "trialcase"}]}], "}"}], ",", 
     RowBox[{"Method", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<QuasiMonteCarlo\>\"", ",", 
        RowBox[{"MaxPoints", "\[Rule]", "1000000"}]}], "}"}]}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8147846120952234`*^9, 3.8147847117660103`*^9}, {
   3.814784776195859*^9, 3.814784831772643*^9}, {3.8147848617732677`*^9, 
   3.8147849365472956`*^9}, {3.8147850550388484`*^9, 3.814785150535645*^9}, {
   3.8147854307493067`*^9, 3.8147854312481885`*^9}, 3.8147881277992125`*^9, {
   3.81478817827001*^9, 3.8147881836737413`*^9}, 3.814854269939273*^9, {
   3.8148544694837914`*^9, 3.814854488262041*^9}, 3.814856759272547*^9, 
   3.814858696231645*^9, {3.814859171831402*^9, 3.814859173173408*^9}, {
   3.8148628318558083`*^9, 3.8148628331603303`*^9}, {3.8148631508629503`*^9, 
   3.814863151769112*^9}, {3.8148655261500587`*^9, 3.8148655263973355`*^9}, 
   3.814866808088716*^9, {3.814867351104596*^9, 
   3.8148673523937063`*^9}},ExpressionUUID->"e0d7e68a-ac63-4e06-9c2a-\
f7252ba18c16"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Spectral Density Calculation", "Section",
 CellChangeTimes->{{3.8147851626141863`*^9, 
  3.8147851698918*^9}},ExpressionUUID->"8e5f58bc-c596-4f63-8360-4c18145bd8ed"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"dNdE\[Gamma]", "[", 
    RowBox[{
    "Q_", ",", "Epulse_", ",", "\[Lambda]_", ",", "\[Sigma]L_", ",", 
     "\[CapitalDelta]Ee_", ",", "Ee_", ",", "\[CapitalDelta]k_", ",", "L_", 
     ",", "\[Beta]x_", ",", "\[Epsilon]nx_", ",", "\[Beta]y_", ",", 
     "\[Epsilon]ny_", ",", "E\[Gamma]_", ",", "\[Tau]_", ",", "\[Phi]f_"}], 
    "]"}], ":=", 
   RowBox[{
    RowBox[{"prefactor", "[", 
     RowBox[{
     "Q", ",", "Epulse", ",", "\[Lambda]", ",", "\[Sigma]L", ",", 
      "\[CapitalDelta]Ee", ",", "Ee", ",", "\[CapitalDelta]k", ",", "L"}], 
     "]"}], "*", 
    RowBox[{"INTterm", "[", 
     RowBox[{
     "\[Beta]x", ",", "Ee", ",", "\[Epsilon]nx", ",", "\[Lambda]", ",", 
      "\[Beta]y", ",", "\[Epsilon]ny", ",", "L", ",", "\[Sigma]L", ",", 
      "E\[Gamma]", ",", "\[Tau]", ",", "\[Phi]f", ",", "\[CapitalDelta]Ee", 
      ",", "\[CapitalDelta]k"}], "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8147852056421185`*^9, 3.8147853563750515`*^9}, 
   3.8148552774139442`*^9, 
   3.814855467269288*^9},ExpressionUUID->"6b32869b-645a-468b-a141-\
dd53f374859c"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"SpecDen", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       FractionBox["E\[Gamma]", "keV"], ",", 
       RowBox[{
        RowBox[{
         FractionBox["phkeVnC", 
          RowBox[{"(", 
           FractionBox[
            RowBox[{"Q", "/.", "trialcase"}], "elecharge"], ")"}]], "*", 
         RowBox[{"dNdE\[Gamma]", "[", 
          RowBox[{
          "Q", ",", "Epulse", ",", "\[Lambda]", ",", "\[Sigma]L", ",", 
           "\[CapitalDelta]Ee", ",", "Ee", ",", "\[CapitalDelta]k", ",", "L", 
           ",", "\[Beta]x", ",", "\[Epsilon]nx", ",", "\[Beta]y", ",", 
           "\[Epsilon]ny", ",", "E\[Gamma]", ",", "\[Tau]", ",", "\[Phi]f"}], 
          "]"}]}], "/.", "trialcase"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"E\[Gamma]", ",", 
       RowBox[{
        RowBox[{"E\[Gamma]set", "[", 
         RowBox[{"\[Lambda]", ",", 
          RowBox[{"Ee", "*", 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"15", "*", "\[CapitalDelta]Ee"}]}], ")"}]}], ",", 
          "\[Phi]", ",", "\[Theta]col"}], "]"}], "/.", "trialcase"}], ",", 
       RowBox[{
        RowBox[{"E\[Gamma]set", "[", 
         RowBox[{"\[Lambda]", ",", 
          RowBox[{"Ee", "*", 
           RowBox[{"(", 
            RowBox[{"1", "+", 
             RowBox[{"3", "*", "\[CapitalDelta]Ee"}]}], ")"}]}], ",", 
          "\[Phi]", ",", "0"}], "]"}], "/.", "trialcase"}], ",", 
       RowBox[{"dE\[Gamma]", "/.", "trialcase"}]}], "}"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.814785358229107*^9, 3.8147854112059965`*^9}, {
  3.814785459235149*^9, 3.8147854642953095`*^9}, {3.814866752315263*^9, 
  3.8148667621131287`*^9}, {3.814867076014434*^9, 
  3.8148670771505046`*^9}},ExpressionUUID->"2519ac27-5618-4947-b55f-\
6d98b618d5ac"],

Cell[BoxData[
 TemplateBox[{
  "NIntegrate","maxp",
   "\"The integral failed to converge after \\!\\(\\*RowBox[{\\\"459496\\\"}]\
\\) integrand evaluations. NIntegrate obtained \
\\!\\(\\*RowBox[{\\\"1.5854140891012305`\\\"}]\\) and \
\\!\\(\\*RowBox[{\\\"0.2901588153862623`\\\"}]\\) for the integral and error \
estimates.\"",2,59,6,21879400986195259945,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.8148565984867716`*^9, 3.8148569046305065`*^9, 
  3.814858701151848*^9, 3.8148592892556934`*^9, 3.814863208590406*^9, 
  3.8148655894537244`*^9, 3.81486685460703*^9, 
  3.8148670823640623`*^9},ExpressionUUID->"1be84e4c-d286-4781-b1b2-\
1cf046baa452"],

Cell[BoxData[
 TemplateBox[{
  "NIntegrate","maxp",
   "\"The integral failed to converge after \\!\\(\\*RowBox[{\\\"459496\\\"}]\
\\) integrand evaluations. NIntegrate obtained \
\\!\\(\\*RowBox[{\\\"1.8679535209776899`\\\"}]\\) and \
\\!\\(\\*RowBox[{\\\"0.37645950311370385`\\\"}]\\) for the integral and error \
estimates.\"",2,59,7,21879400986195259945,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.8148565984867716`*^9, 3.8148569046305065`*^9, 
  3.814858701151848*^9, 3.8148592892556934`*^9, 3.814863208590406*^9, 
  3.8148655894537244`*^9, 3.81486685460703*^9, 
  3.8148670838551016`*^9},ExpressionUUID->"be70f2f2-77ff-47cb-ae7f-\
6bf2cafa222e"],

Cell[BoxData[
 TemplateBox[{
  "NIntegrate","maxp",
   "\"The integral failed to converge after \\!\\(\\*RowBox[{\\\"459496\\\"}]\
\\) integrand evaluations. NIntegrate obtained \
\\!\\(\\*RowBox[{\\\"2.1110543080950253`\\\"}]\\) and \
\\!\\(\\*RowBox[{\\\"0.4381444783205969`\\\"}]\\) for the integral and error \
estimates.\"",2,59,8,21879400986195259945,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.8148565984867716`*^9, 3.8148569046305065`*^9, 
  3.814858701151848*^9, 3.8148592892556934`*^9, 3.814863208590406*^9, 
  3.8148655894537244`*^9, 3.81486685460703*^9, 
  3.814867085318159*^9},ExpressionUUID->"d022aba1-de9b-4659-b961-\
f0968af1ce1e"],

Cell[BoxData[
 TemplateBox[{
  "General","stop",
   "\"Further output of \\!\\(\\*StyleBox[RowBox[{\\\"NIntegrate\\\", \
\\\"::\\\", \\\"maxp\\\"}], \\\"MessageName\\\"]\\) will be suppressed during \
this calculation.\"",2,59,9,21879400986195259945,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.8148565984867716`*^9, 3.8148569046305065`*^9, 
  3.814858701151848*^9, 3.8148592892556934`*^9, 3.814863208590406*^9, 
  3.8148655894537244`*^9, 3.81486685460703*^9, 
  3.8148670853410993`*^9},ExpressionUUID->"a3106ff9-b833-4c9d-a004-\
6dc58db518de"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ListLinePlot", "[", 
  RowBox[{"SpecDen", ",", 
   RowBox[{"Frame", "\[Rule]", "True"}], ",", 
   RowBox[{"FrameLabel", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
     "\"\<Scattered Photon Energy (keV)\>\"", ",", 
      "\"\<Spectral Density (ph/keV/nC)\>\""}], "}"}]}], ",", 
   RowBox[{"PlotRange", "\[Rule]", "Full"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8006270421557465`*^9, 3.8006270874845505`*^9}, {
   3.8006271254839315`*^9, 3.8006271381380634`*^9}, {3.8006280250741863`*^9, 
   3.800628077219696*^9}, {3.8006281347010193`*^9, 3.8006281412903833`*^9}, {
   3.8006282415691967`*^9, 3.8006282455296173`*^9}, 3.8012153675246315`*^9, {
   3.8012159787366595`*^9, 3.801215979133586*^9}, {3.803021524126484*^9, 
   3.8030215244087305`*^9}, 3.803023283802849*^9, {3.8036241754776244`*^9, 
   3.803624176636043*^9}, {3.803712982133995*^9, 3.80371298575631*^9}, {
   3.8037130404739275`*^9, 3.8037130482151847`*^9}, {3.8038813417275906`*^9, 
   3.8038813468063326`*^9}, {3.80666542082672*^9, 3.8066654220560446`*^9}, {
   3.80681971081198*^9, 3.80681971513642*^9}, {3.806820080068489*^9, 
   3.806820082028203*^9}, {3.8068203693708525`*^9, 3.8068203737340264`*^9}, {
   3.8072702571233797`*^9, 3.8072702582389913`*^9}, {3.8081192257730503`*^9, 
   3.808119266601926*^9}, {3.8081351660221157`*^9, 3.808135200992709*^9}, {
   3.812193539336771*^9, 3.8121935403692894`*^9}, {3.8148630745993085`*^9, 
   3.8148630767029514`*^9}, {3.8148663964555464`*^9, 
   3.8148664048092327`*^9}, {3.814866477297323*^9, 3.8148665150174356`*^9}, {
   3.814866770572815*^9, 
   3.8148667760500665`*^9}},ExpressionUUID->"80385f71-d959-4b7c-b204-\
1d98472e8c80"],

Cell[BoxData[
 GraphicsBox[{{}, {{}, {}, 
    {RGBColor[0.368417, 0.506779, 0.709798], PointSize[0.016666666666666666`],
      AbsoluteThickness[1.6], LineBox[CompressedData["
1:eJwt0m1M03cQB/CKoCsO1vg0HBCkiCBgBCqCBeRrQdQ1UIZA+8+cJpoCcQoE
YnM/jQFS3aYDRDFOjQ43jYCkm/jAwwIZUahjWBSNTCCYxYrPU3yYC9sAK9cX
l8vlm3zuxZ3/pvx0o4tMJkty1PsuP3qszVhAuGvO2+mndUX8NdvIkSKC18Y1
4s2j6SiYkC24ZiLUfFd5rtxtBk5FLtVPCIK8rNN4dqYH+ow5+yJ3EZK+zDHk
1nhi0ishBHW/CplTpmDPTCipLk5Lvj6Tva8I23b8rLJumsveXgKZ4kMGZnuz
V06I9UvtNAXPZ6+S0D710xXTbUr2qginb5p6mvcGsnfYsV97Y/3Tr4PZO0qI
vuj+OnxdKHsnHHnalDjXhjD2ThI6eqz2uo5Q9k4R8g5E2OM2LmLvDGF7sar8
TmMQe3UExZzTDb80BbNnIfg8X58X+LvTO0cYjlT9UG6OYO8CofObQ31J/lHs
NRL8LGqp9lEMey2EqNoXO7SX4thrI0TMmHA9GAb22gkb1pk01fdWsnfF4UfX
tfzYlMieldCiXeD2r0cye12Ebx/s/Gfg7Rr2bAQp6ol19KmWvRuO+7XXqo+F
prJ3i6Dpkg0NGXTs9RGya8z/m+p17PUTcvb4fNSzX8feEMF0vvJl1Gode38S
/n6VmLJ23OnZCcpo9VqNl9N7QCiVfAsDFGnsPSb0T+mI1S/+jL2/CE2ie+Rk
Yzp7IwT1rID7rUsz2HtNsBQmrPb0zmTvrePfClZ8YfHLZG+UMF76R+LnZRns
jRFGu22UvySDPZlARX2RpqHT6U0V+E9e0XtVn8XeNIEAddnsS8sM7MkFPlQu
zAw/ILHnIbAk/IN9t8ck9hSOWXcvyKVKYm+WQODgyjDzRQN7cwUeFh8c7rXr
2ZsnkLrdvff6cT17vgL5u3+6n+FtYG++QILyuTX2E6cXIPDx94Pm5XaJvYUC
Gyq7qp5ZJfYWCfxWH+Mp7TKwt1igYMC4xd0ti71wgZhm16SUzensqQSsluzC
y9Va9pYJyOUPjb+6aNhbLpCdEnTHdFXFXrzAbcXWlvFhf/Yg0K+cdmRVqjt7
iQITrW+eFM17kTDpJQu89ErObd1sS3gHXXPsFg==
      "]]}}, {}, {}, {}, {}},
  AspectRatio->NCache[GoldenRatio^(-1), 0.6180339887498948],
  Axes->{True, True},
  AxesLabel->{None, None},
  AxesOrigin->{390.8154640234925, 0},
  DisplayFunction->Identity,
  Frame->{{True, True}, {True, True}},
  FrameLabel->{{
     FormBox["\"Spectral Density (ph/keV/nC)\"", TraditionalForm], None}, {
     FormBox["\"Scattered Photon Energy (keV)\"", TraditionalForm], None}},
  FrameTicks->{{Automatic, Automatic}, {Automatic, Automatic}},
  GridLines->{None, None},
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  ImagePadding->All,
  ImageSize->{481., Automatic},
  Method->{"CoordinatesToolOptions" -> {"DisplayFunction" -> ({
        (Identity[#]& )[
         Part[#, 1]], 
        (Identity[#]& )[
         Part[#, 2]]}& ), "CopiedValueFunction" -> ({
        (Identity[#]& )[
         Part[#, 1]], 
        (Identity[#]& )[
         Part[#, 2]]}& )}},
  PlotRange->{{391.02483902349246`, 404.4248390234925}, {
    0, 103.96615839767104`}},
  PlotRangeClipping->True,
  PlotRangePadding->{{
     Scaled[0.02], 
     Scaled[0.02]}, {
     Scaled[0.02], 
     Scaled[0.05]}},
  Ticks->{Automatic, Automatic}]], "Output",
 CellChangeTimes->{3.8148567230054607`*^9, 3.8148579611895075`*^9, 
  3.8148588290418158`*^9, 3.814862789861476*^9, 3.814863081312512*^9, 
  3.8148654870141773`*^9, 3.8148667402783623`*^9, 3.8148669735723104`*^9, 
  3.8148672308043833`*^9},ExpressionUUID->"b5ef7f9c-249e-440c-a420-\
cf47b8e97bef"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Spectral Density Per Electron", "Section",
 CellChangeTimes->{{3.814863014725563*^9, 
  3.814863026370117*^9}},ExpressionUUID->"09ddd070-bfa4-4332-8d6d-\
baf5369f3c91"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SpecDenElectron", "=", 
   RowBox[{"Partition", "[", 
    RowBox[{
     RowBox[{"Riffle", "[", 
      RowBox[{
       RowBox[{"SpecDen", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
       FractionBox[
        RowBox[{"SpecDen", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}], "phkeVnC"]}], 
      "]"}], ",", "2"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.814867253529702*^9, 
  3.8148672645407147`*^9}},ExpressionUUID->"a29554f6-b43f-42ac-8cb3-\
58ccc8de07a0"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ListLinePlot", "[", 
  RowBox[{"SpecDenElectron", ",", 
   RowBox[{"AxesLabel", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
     "\"\<Scattered Photon Energy (keV)\>\"", ",", 
      "\"\<Spectral Density (\!\(\*SuperscriptBox[\(eV\), \
\(-1\)]\)\!\(\*SuperscriptBox[\(electron\), \(-1\)]\))\>\""}], "}"}]}], ",", 
   RowBox[{"PlotRange", "\[Rule]", "Full"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8006270421557465`*^9, 3.8006270874845505`*^9}, {
   3.8006271254839315`*^9, 3.8006271381380634`*^9}, {3.8006280250741863`*^9, 
   3.800628077219696*^9}, {3.8006281347010193`*^9, 3.8006281412903833`*^9}, {
   3.8006282415691967`*^9, 3.8006282455296173`*^9}, 3.8012153675246315`*^9, {
   3.8012159787366595`*^9, 3.801215979133586*^9}, {3.803021524126484*^9, 
   3.8030215244087305`*^9}, 3.803023283802849*^9, {3.8036241754776244`*^9, 
   3.803624176636043*^9}, {3.803712982133995*^9, 3.80371298575631*^9}, {
   3.8037130404739275`*^9, 3.8037130482151847`*^9}, {3.8038813417275906`*^9, 
   3.8038813468063326`*^9}, {3.80666542082672*^9, 3.8066654220560446`*^9}, {
   3.80681971081198*^9, 3.80681971513642*^9}, {3.806820080068489*^9, 
   3.806820082028203*^9}, {3.8068203693708525`*^9, 3.8068203737340264`*^9}, {
   3.8072702571233797`*^9, 3.8072702582389913`*^9}, {3.8081192257730503`*^9, 
   3.808119266601926*^9}, {3.8081351660221157`*^9, 3.808135200992709*^9}, {
   3.812193539336771*^9, 3.8121935403692894`*^9}, {3.8148631035657578`*^9, 
   3.8148631049987583`*^9}},ExpressionUUID->"5ebbc8be-d41b-4df1-8731-\
9a58d1f5b0ce"],

Cell[BoxData[
 GraphicsBox[{{}, {{}, {}, 
    {RGBColor[0.368417, 0.506779, 0.709798], PointSize[0.016666666666666666`],
      AbsoluteThickness[1.6], LineBox[CompressedData["
1:eJwt0n1MzHEcB/BLspRkS21MT3pQzMZJHPvNJwqFufL8cCh362EUmvp8U+mJ
RULTquthpaur7K7uDm2x89ADHS5NuiHqEDpPmbA1xI9Pf3z32Xff91777PP5
ekYlRMgmCASCYP78q5PlpXrZIYR0pi+Nl+/muAfGLyWJCBU+w0Eznu7jDv0R
eD9IQuD6y9/F2e3nFMKAbX8Yf7cpj0pIlXImWfRpYRrC9MKwmGq5jPvvZSDU
duX0vwiPJi8boSR6QOmaFUfeSYQ4yfYn4WcSyDuFYM4bqBI6J5KXz7+f9Sxn
HUnknUfwCzcuHklPIe8CwtKpaW7xO9PJK0Kw+ximmxWaSZ4c4U2d6a17UDZ5
FQimfZpzVUtyyKtCsL5b4exckE2eAqF/9Imh15xJnhLh+MxlnveuZpDXgJC8
ud7JGJdJnhph0DCs3hI67mkQsi4n9lQ25pJ3GcHtYHqb6G4+ec0IrLYscE1+
AXktCM4+9hE1ywrJ0/Pz6VC5r7pfRN4tBFfh3uLSADl5bQiz2xuiCw1l5N1B
uHKz5Xr39EryDAi5OZ83rS2+SJ4RQZ3WdKZTpSCvG+GaW6tYtrKWvB6E5TEW
p0YXJXkmvp8PxeaXYiV5TxFCpI+3SjkleS94XzToxdkpyTMj9PWGRz4zjXuv
Eew7QvLnWGrJe4uwXlaXuVAx7lkQvE4YV3gsrifvE8KUvm/vI/deIu8LgodI
kPeKqcgb4fdpEgfgDTV5P/j/MdaV/bNdTd4owjwfbbzku4q83wilBc/yYo+o
yBMwuK2/Mjp3tZo8awbL/dj5ntQm8iYx4Gqshl85asmbzODd0LDUdqKOPAc+
v6v/UZFYR940Pt+1tVpsoyPPiUGjwzFDboyWPBcGcyWKrym9GvJmMNiot3p+
WKEhz5XBsaSHypJfGvI8GIz27vAP1GjJ82Kw8PuGdhOnI8+Xge/Gvvo3/jry
/Bm0rvNubgjSkjefge0nD9NS2ybyFjBI2NMZO2JpIG8Rn5dIxpySFeQFMvDD
A53mSDl5IgYprRnWrwfyyOMY3G85kbRLxMgDBm1HHYeCT0WRt4qB9MOgZcwS
Qt5qBhOE14vOXfXm/gLUzwwJ
      "]]}}, {}, {}, {}, {}},
  AspectRatio->NCache[GoldenRatio^(-1), 0.6180339887498948],
  Axes->{True, True},
  AxesLabel->{
    FormBox["\"Scattered Photon Energy (keV)\"", TraditionalForm], 
    FormBox[
    "\"Spectral Density (\\!\\(\\*SuperscriptBox[\\(eV\\), \\(-1\\)]\\)\\!\\(\
\\*SuperscriptBox[\\(electron\\), \\(-1\\)]\\))\"", TraditionalForm]},
  AxesOrigin->{390.8154640234925, 0},
  DisplayFunction->Identity,
  Frame->{{False, False}, {False, False}},
  FrameLabel->{{None, None}, {None, None}},
  FrameTicks->{{Automatic, Automatic}, {Automatic, Automatic}},
  GridLines->{None, None},
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  ImagePadding->All,
  ImageSize->{512., Automatic},
  Method->{"CoordinatesToolOptions" -> {"DisplayFunction" -> ({
        (Identity[#]& )[
         Part[#, 1]], 
        (Identity[#]& )[
         Part[#, 2]]}& ), "CopiedValueFunction" -> ({
        (Identity[#]& )[
         Part[#, 1]], 
        (Identity[#]& )[
         Part[#, 2]]}& )}},
  PlotRange->{{391.02483902349246`, 404.4248390234925}, {
    0, 1.6657214825596524`*^-11}},
  PlotRangeClipping->True,
  PlotRangePadding->{{
     Scaled[0.02], 
     Scaled[0.02]}, {
     Scaled[0.02], 
     Scaled[0.05]}},
  Ticks->{Automatic, Automatic}]], "Output",
 CellChangeTimes->{{3.8148630932613335`*^9, 3.8148631057995963`*^9}, 
   3.814865491276519*^9, 
   3.8148672712194347`*^9},ExpressionUUID->"95f2c56a-d579-4b06-b117-\
7b171c2afbf3"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Saving", "Section",
 CellChangeTimes->{{3.8148628907404947`*^9, 
  3.814862891907714*^9}},ExpressionUUID->"8788676a-7d68-406f-a318-\
56696934b5cf"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
  "SetDirectory", "[", 
   "\"\<C:/Users/user/Documents/Wolfram Mathematica/SUN2D_results\>\"", "]"}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SpecDen", ">>", "\"\<CBETA150_0.5mil.txt\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SpecDenElectron", ">>", "\"\<CBETA150e-_0.5mil.txt\>\""}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.814862922237955*^9, 3.8148629525399227`*^9}, {
  3.8148630378172283`*^9, 3.814863061298443*^9}, {3.8148631588005867`*^9, 
  3.814863161236628*^9}, {3.814866181308338*^9, 3.8148661847022877`*^9}, {
  3.8148667955597515`*^9, 
  3.8148668039620576`*^9}},ExpressionUUID->"780e1a0c-c14a-464a-ab68-\
8524b01f1a00"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["SUN 2D Benchmarking", "Title",
 CellChangeTimes->{{3.8148661986439714`*^9, 
  3.814866207039516*^9}},ExpressionUUID->"55be236d-a847-4968-a6a2-\
200792cc3ef2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "SetDirectory", "[", 
   "\"\<C:/Users/user/Documents/Wolfram Mathematica/SUN2D_results\>\"", "]"}],
   ";"}]], "Input",
 CellChangeTimes->{{3.814866234796009*^9, 
  3.8148662476306515`*^9}},ExpressionUUID->"c050cfb8-3fc0-4044-a890-\
ab1dd43a3def"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CBETA150mil05", "=", 
   RowBox[{"<<", "\"\<CBETA150e-_0.5mil.txt\>\""}]}], ";"}]], "Input",
 CellChangeTimes->{{3.814866269367465*^9, 3.8148663762565737`*^9}, {
  3.814867286391141*^9, 
  3.814867303528196*^9}},ExpressionUUID->"73b9dbf0-9857-4151-af11-\
ea453b4c6244"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ListLinePlot", "[", 
  RowBox[{"CBETA150mil05", ",", 
   RowBox[{"AxesLabel", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
     "\"\<Scattered Photon Energy (keV)\>\"", ",", 
      "\"\<Spectral Density (\!\(\*SuperscriptBox[\(eV\), \
\(-1\)]\)\!\(\*SuperscriptBox[\(electron\), \(-1\)]\))\>\""}], "}"}]}], ",", 
   RowBox[{"PlotRange", "\[Rule]", "Full"}]}], "]"}]], "Input",
 CellChangeTimes->{
  3.8148673162033772`*^9},ExpressionUUID->"f26cee97-b5c2-4cf3-adc8-\
ba5baa0f9943"],

Cell[BoxData[
 GraphicsBox[{{}, {{}, {}, 
    {RGBColor[0.368417, 0.506779, 0.709798], PointSize[0.016666666666666666`],
      AbsoluteThickness[1.6], LineBox[CompressedData["
1:eJwt0n1MzHEcB/BLspRkS21MT3pQzMZJHPvNJwqFufL8cCh362EUmvp8U+mJ
RULTquthpaur7K7uDm2x89ADHS5NuiHqEDpPmbA1xI9Pf3z32Xff91777PP5
ekYlRMgmCASCYP78q5PlpXrZIYR0pi+Nl+/muAfGLyWJCBU+w0Eznu7jDv0R
eD9IQuD6y9/F2e3nFMKAbX8Yf7cpj0pIlXImWfRpYRrC9MKwmGq5jPvvZSDU
duX0vwiPJi8boSR6QOmaFUfeSYQ4yfYn4WcSyDuFYM4bqBI6J5KXz7+f9Sxn
HUnknUfwCzcuHklPIe8CwtKpaW7xO9PJK0Kw+ximmxWaSZ4c4U2d6a17UDZ5
FQimfZpzVUtyyKtCsL5b4exckE2eAqF/9Imh15xJnhLh+MxlnveuZpDXgJC8
ud7JGJdJnhph0DCs3hI67mkQsi4n9lQ25pJ3GcHtYHqb6G4+ec0IrLYscE1+
AXktCM4+9hE1ywrJ0/Pz6VC5r7pfRN4tBFfh3uLSADl5bQiz2xuiCw1l5N1B
uHKz5Xr39EryDAi5OZ83rS2+SJ4RQZ3WdKZTpSCvG+GaW6tYtrKWvB6E5TEW
p0YXJXkmvp8PxeaXYiV5TxFCpI+3SjkleS94XzToxdkpyTMj9PWGRz4zjXuv
Eew7QvLnWGrJe4uwXlaXuVAx7lkQvE4YV3gsrifvE8KUvm/vI/deIu8LgodI
kPeKqcgb4fdpEgfgDTV5P/j/MdaV/bNdTd4owjwfbbzku4q83wilBc/yYo+o
yBMwuK2/Mjp3tZo8awbL/dj5ntQm8iYx4Gqshl85asmbzODd0LDUdqKOPAc+
v6v/UZFYR940Pt+1tVpsoyPPiUGjwzFDboyWPBcGcyWKrym9GvJmMNiot3p+
WKEhz5XBsaSHypJfGvI8GIz27vAP1GjJ82Kw8PuGdhOnI8+Xge/Gvvo3/jry
/Bm0rvNubgjSkjefge0nD9NS2ybyFjBI2NMZO2JpIG8Rn5dIxpySFeQFMvDD
A53mSDl5IgYprRnWrwfyyOMY3G85kbRLxMgDBm1HHYeCT0WRt4qB9MOgZcwS
Qt5qBhOE14vOXfXm/gLUzwwJ
      "]]}}, {}, {}, {}, {}},
  AspectRatio->NCache[GoldenRatio^(-1), 0.6180339887498948],
  Axes->{True, True},
  AxesLabel->{
    FormBox["\"Scattered Photon Energy (keV)\"", TraditionalForm], 
    FormBox[
    "\"Spectral Density (\\!\\(\\*SuperscriptBox[\\(eV\\), \\(-1\\)]\\)\\!\\(\
\\*SuperscriptBox[\\(electron\\), \\(-1\\)]\\))\"", TraditionalForm]},
  AxesOrigin->{390.8154640234925, 0},
  DisplayFunction->Identity,
  Frame->{{False, False}, {False, False}},
  FrameLabel->{{None, None}, {None, None}},
  FrameTicks->{{Automatic, Automatic}, {Automatic, Automatic}},
  GridLines->{None, None},
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  ImagePadding->All,
  Method->{"CoordinatesToolOptions" -> {"DisplayFunction" -> ({
        (Identity[#]& )[
         Part[#, 1]], 
        (Identity[#]& )[
         Part[#, 2]]}& ), "CopiedValueFunction" -> ({
        (Identity[#]& )[
         Part[#, 1]], 
        (Identity[#]& )[
         Part[#, 2]]}& )}},
  PlotRange->{{391.02483902349246`, 404.4248390234925}, {
    0, 1.6657214825596524`*^-11}},
  PlotRangeClipping->True,
  PlotRangePadding->{{
     Scaled[0.02], 
     Scaled[0.02]}, {
     Scaled[0.02], 
     Scaled[0.05]}},
  Ticks->{Automatic, Automatic}]], "Output",
 CellChangeTimes->{
  3.814867317014854*^9},ExpressionUUID->"676e83c0-15c8-468f-b077-\
6ca429b6b14e"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1536, 781},
WindowMargins->{{-8, Automatic}, {Automatic, -8}},
FrontEndVersion->"11.2 for Microsoft Windows (64-bit) (September 10, 2017)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 174, 3, 96, "Title",ExpressionUUID->"140bdbae-bad8-4718-a1da-eb929332eda8"],
Cell[757, 27, 1546, 28, 111, "Text",ExpressionUUID->"2b8ba76a-521c-469f-a378-d7396e3be18e"],
Cell[2306, 57, 3048, 68, 197, "Text",ExpressionUUID->"b97ac988-8150-4d2e-9ea9-1c81e9f89e5a"],
Cell[CellGroupData[{
Cell[5379, 129, 222, 4, 67, "Section",ExpressionUUID->"0c691fe7-f078-4b73-b0b2-e8e11224ef50"],
Cell[5604, 135, 1484, 43, 200, "Input",ExpressionUUID->"b7330d44-48d7-4587-bf2f-669d7a521eec"],
Cell[7091, 180, 330, 9, 77, "Input",ExpressionUUID->"cc040c97-18d7-4864-a1bf-7d6c20093d98"],
Cell[7424, 191, 1241, 37, 124, "Input",ExpressionUUID->"eb0670cf-8d1f-4e7f-b50c-51870fa97b68"],
Cell[8668, 230, 1901, 45, 75, "Input",ExpressionUUID->"78274ea2-4074-44ab-b60e-c38b34777866"],
Cell[10572, 277, 541, 10, 34, "Text",ExpressionUUID->"5a7255cc-4cb7-4315-aa47-649dd4320a6e"],
Cell[11116, 289, 210, 5, 28, "Input",ExpressionUUID->"88085e3a-c9bd-487d-9f11-8a678445720b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[11363, 299, 159, 3, 67, "Section",ExpressionUUID->"73306ef9-b535-4255-bfaa-26c2b011dfb3"],
Cell[11525, 304, 1478, 36, 78, "Text",ExpressionUUID->"7d905146-42f5-4912-9329-98e166c94607"],
Cell[13006, 342, 278, 7, 48, "Input",ExpressionUUID->"ca85d083-699b-410f-b9b2-f2c91e543445"]
}, Open  ]],
Cell[CellGroupData[{
Cell[13321, 354, 183, 3, 67, "Section",ExpressionUUID->"f79b353f-495c-44e0-8fd1-109668ba2a83"],
Cell[13507, 359, 1429, 36, 148, "Input",ExpressionUUID->"14fbce26-d4ca-47eb-93ea-3cbf030842bc"],
Cell[14939, 397, 827, 21, 34, "Text",ExpressionUUID->"f22e5c92-3d4f-4dbb-9588-9512c8608a66"]
}, Open  ]],
Cell[CellGroupData[{
Cell[15803, 423, 170, 3, 67, "Section",ExpressionUUID->"5848973f-df18-4c43-a41b-45fc7afb6898"],
Cell[15976, 428, 1146, 31, 66, "Input",ExpressionUUID->"474d960b-eeac-40ec-9e02-c6ce3bfae19b"],
Cell[CellGroupData[{
Cell[17147, 463, 450, 9, 28, "Input",ExpressionUUID->"39f1731c-3f04-43a0-9047-eb4237aeeac0"],
Cell[17600, 474, 973, 14, 32, "Output",ExpressionUUID->"669b63bf-c5c0-4cf0-9fd2-daa4f9bf23b9"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[18622, 494, 166, 3, 67, "Section",ExpressionUUID->"37fb731a-1f47-4ee8-898e-59303288decc"],
Cell[18791, 499, 2533, 63, 333, "Input",ExpressionUUID->"f8cbeea9-2ad4-4dc0-ae9f-1f8f97a494ed"],
Cell[21327, 564, 556, 14, 34, "Text",ExpressionUUID->"519f89c2-1ec0-49d8-9be6-c3b556101979"]
}, Open  ]],
Cell[CellGroupData[{
Cell[21920, 583, 156, 3, 67, "Section",ExpressionUUID->"1e00b6b6-3881-4e8e-8a8d-b629c21315e0"],
Cell[22079, 588, 533, 15, 28, "Input",ExpressionUUID->"efdcc4aa-8608-4cd1-9179-a8c95d678384"],
Cell[22615, 605, 1578, 40, 129, "Input",ExpressionUUID->"c50dd82b-7f3a-4da3-be6a-1cd8235e6720"],
Cell[24196, 647, 1714, 56, 36, "Text",ExpressionUUID->"e9e59e34-50e9-42b1-8c05-77504d064191"]
}, Open  ]],
Cell[CellGroupData[{
Cell[25947, 708, 165, 3, 67, "Section",ExpressionUUID->"c6182301-d15a-4145-928c-6083680aca5d"],
Cell[26115, 713, 650, 18, 36, "Text",ExpressionUUID->"a579b177-1ed7-480b-9e2d-ab42c8c60908"],
Cell[26768, 733, 7218, 188, 503, "Input",ExpressionUUID->"4c95d470-1795-4e28-8701-6767394f65c5"],
Cell[33989, 923, 459, 8, 34, "Text",ExpressionUUID->"f0243cbe-dae8-4a0e-aa2b-050072e394fa"],
Cell[34451, 933, 756, 22, 48, "Input",ExpressionUUID->"48f7935f-38b0-41e8-9a60-e9d30415ea8d"]
}, Open  ]],
Cell[CellGroupData[{
Cell[35244, 960, 156, 3, 67, "Section",ExpressionUUID->"b135858d-9011-4e0b-b9e8-ec69df382cbb"],
Cell[35403, 965, 1220, 28, 59, "Input",ExpressionUUID->"44a58f3f-cd50-4df1-938b-1f9d9025910f"],
Cell[CellGroupData[{
Cell[36648, 997, 489, 11, 28, "Input",ExpressionUUID->"133f7a76-249b-414e-9ad1-5f9f8cb3d402"],
Cell[37140, 1010, 1039, 20, 46, "Output",ExpressionUUID->"605f9715-4e96-4798-a241-6d053c0f4e63"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[38228, 1036, 170, 3, 67, "Section",ExpressionUUID->"c54aade0-d934-4102-8eed-9f6b9a459f98"],
Cell[38401, 1041, 1504, 34, 54, "Input",ExpressionUUID->"f8442268-537c-4362-981e-dfe1244b5cfc"],
Cell[39908, 1077, 1026, 26, 67, "Input",ExpressionUUID->"e60fd43d-c1ae-4676-9f39-e09d48af13bb"],
Cell[40937, 1105, 3742, 95, 59, "Input",ExpressionUUID->"8e8e441e-12fb-4240-a2b0-5f1d7aae10ee"],
Cell[44682, 1202, 2601, 65, 91, "Input",ExpressionUUID->"8700b1b8-6c92-4388-a561-3238d3080147"]
}, Open  ]],
Cell[CellGroupData[{
Cell[47320, 1272, 160, 3, 67, "Section",ExpressionUUID->"497caded-e072-43e3-bfba-4c32a248c4b6"],
Cell[47483, 1277, 1705, 36, 48, "Input",ExpressionUUID->"330e0fd1-102e-4bc5-8f6d-a0a531ea1c4c"],
Cell[49191, 1315, 3688, 89, 86, "Input",ExpressionUUID->"e0d7e68a-ac63-4e06-9c2a-f7252ba18c16"]
}, Open  ]],
Cell[CellGroupData[{
Cell[52916, 1409, 171, 2, 67, "Section",ExpressionUUID->"8e5f58bc-c596-4f63-8360-4c18145bd8ed"],
Cell[53090, 1413, 1117, 25, 28, "Input",ExpressionUUID->"6b32869b-645a-468b-a141-dd53f374859c"],
Cell[CellGroupData[{
Cell[54232, 1442, 1829, 45, 105, "Input",ExpressionUUID->"2519ac27-5618-4947-b55f-6d98b618d5ac"],
Cell[56064, 1489, 678, 13, 21, "Message",ExpressionUUID->"1be84e4c-d286-4781-b1b2-1cf046baa452"],
Cell[56745, 1504, 679, 13, 21, "Message",ExpressionUUID->"be70f2f2-77ff-47cb-ae7f-6bf2cafa222e"],
Cell[57427, 1519, 676, 13, 21, "Message",ExpressionUUID->"d022aba1-de9b-4659-b961-f0968af1ce1e"],
Cell[58106, 1534, 571, 11, 21, "Message",ExpressionUUID->"a3106ff9-b833-4c9d-a004-6dc58db518de"]
}, Open  ]],
Cell[CellGroupData[{
Cell[58714, 1550, 1671, 28, 28, "Input",ExpressionUUID->"80385f71-d959-4b7c-b204-1d98472e8c80"],
Cell[60388, 1580, 2786, 61, 325, "Output",ExpressionUUID->"b5ef7f9c-249e-440c-a420-cf47b8e97bef"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[63223, 1647, 174, 3, 67, "Section",ExpressionUUID->"09ddd070-bfa4-4332-8d6d-baf5369f3c91"],
Cell[63400, 1652, 593, 15, 55, "Input",ExpressionUUID->"a29554f6-b43f-42ac-8cb3-58ccc8de07a0"],
Cell[CellGroupData[{
Cell[64018, 1671, 1548, 25, 32, "Input",ExpressionUUID->"5ebbc8be-d41b-4df1-8731-9a58d1f5b0ce"],
Cell[65569, 1698, 2756, 62, 226, "Output",ExpressionUUID->"95f2c56a-d579-4b06-b117-7b171c2afbf3"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[68374, 1766, 153, 3, 67, "Section",ExpressionUUID->"8788676a-7d68-406f-a318-56696934b5cf"],
Cell[68530, 1771, 708, 17, 67, "Input",ExpressionUUID->"780e1a0c-c14a-464a-ab68-8524b01f1a00"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[69287, 1794, 164, 3, 96, "Title",ExpressionUUID->"55be236d-a847-4968-a6a2-200792cc3ef2"],
Cell[69454, 1799, 285, 8, 28, "Input",ExpressionUUID->"c050cfb8-3fc0-4044-a890-ab1dd43a3def"],
Cell[69742, 1809, 304, 7, 28, "Input",ExpressionUUID->"73b9dbf0-9857-4151-af11-ea453b4c6244"],
Cell[CellGroupData[{
Cell[70071, 1820, 503, 12, 32, "Input",ExpressionUUID->"f26cee97-b5c2-4cf3-adc8-ba5baa0f9943"],
Cell[70577, 1834, 2645, 60, 134, "Output",ExpressionUUID->"676e83c0-15c8-468f-b077-6ca429b6b14e"]
}, Open  ]]
}, Open  ]]
}
]
*)

